<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beelze Apps - Alternative App Store</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f9fafb; color: #111827; min-height: 100vh; }
        
        .header { background: white; padding: 16px; border-bottom: 1px solid #e5e7eb; position: sticky; top: 0; z-index: 50; }
        .header-content { max-width: 768px; margin: 0 auto; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .logo { font-size: 24px; font-weight: bold; background: linear-gradient(to right, #059669, #0d9488); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .logo-sub { font-size: 12px; color: #6b7280; }
        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 16px; background: #059669; color: white; border: none; border-radius: 12px; font-weight: 500; cursor: pointer; font-size: 14px; }
        .btn:hover { background: #047857; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-outline { background: white; color: #374151; border: 1px solid #e5e7eb; }
        .btn-outline:hover { background: #f9fafb; }
        
        .search-box { position: relative; }
        .search-box svg { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; color: #9ca3af; }
        .search-input { width: 100%; padding: 14px 16px 14px 48px; background: #f3f4f6; border: none; border-radius: 16px; font-size: 16px; outline: none; }
        .search-input:focus { background: white; box-shadow: 0 0 0 2px #059669; }
        
        .categories { display: flex; gap: 8px; padding: 16px; max-width: 768px; margin: 0 auto; overflow-x: auto; }
        .cat-btn { display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: #f3f4f6; border: none; border-radius: 50px; font-weight: 500; font-size: 14px; color: #4b5563; cursor: pointer; white-space: nowrap; }
        .cat-btn.active { background: #059669; color: white; box-shadow: 0 4px 12px rgba(5,150,105,0.3); }
        .cat-btn svg { width: 16px; height: 16px; }
        
        .main { max-width: 768px; margin: 0 auto; padding: 0 16px 100px; }
        
        .featured { background: linear-gradient(135deg, #059669, #0d9488); border-radius: 24px; padding: 24px; color: white; margin-bottom: 24px; box-shadow: 0 10px 40px rgba(5,150,105,0.3); cursor: pointer; }
        .featured-content { display: flex; gap: 20px; }
        .featured-icon { width: 96px; height: 96px; border-radius: 20px; object-fit: cover; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .featured-badge { display: inline-block; padding: 4px 12px; background: rgba(255,255,255,0.2); border-radius: 50px; font-size: 12px; margin-bottom: 8px; }
        .featured-title { font-size: 20px; font-weight: bold; margin-bottom: 4px; }
        .featured-desc { color: rgba(255,255,255,0.8); font-size: 14px; margin-bottom: 12px; }
        .featured-stats { display: flex; align-items: center; gap: 16px; font-size: 14px; }
        
        .app-card { background: white; border-radius: 16px; padding: 16px; margin-bottom: 12px; border: 1px solid #e5e7eb; display: flex; gap: 16px; cursor: pointer; transition: all 0.2s; }
        .app-card:hover { box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-color: #a7f3d0; transform: translateY(-2px); }
        .app-icon-wrap { position: relative; flex-shrink: 0; }
        .app-icon { width: 80px; height: 80px; border-radius: 16px; object-fit: cover; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .app-badge { position: absolute; bottom: -4px; right: -4px; padding: 6px; background: #d1fae5; border-radius: 8px; }
        .app-badge svg { width: 12px; height: 12px; color: #059669; }
        .app-info { flex: 1; min-width: 0; }
        .app-title { font-weight: 600; color: #111827; margin-bottom: 2px; }
        .app-author { font-size: 14px; color: #6b7280; margin-bottom: 4px; }
        .app-desc { font-size: 12px; color: #9ca3af; margin-bottom: 8px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .app-stats { display: flex; align-items: center; gap: 12px; font-size: 12px; color: #6b7280; }
        .app-stats svg { width: 12px; height: 12px; }
        
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #e5e7eb; padding: 8px 0 env(safe-area-inset-bottom); z-index: 50; }
        .nav-content { max-width: 768px; margin: 0 auto; display: flex; justify-content: space-around; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px 24px; color: #6b7280; text-decoration: none; font-size: 12px; font-weight: 500; cursor: pointer; border: none; background: none; }
        .nav-item.active { color: #059669; }
        .nav-item svg { width: 24px; height: 24px; }
        .nav-avatar { width: 24px; height: 24px; background: linear-gradient(135deg, #34d399, #14b8a6); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; font-weight: bold; }
        
        .empty { text-align: center; padding: 60px 20px; }
        .empty-icon { width: 80px; height: 80px; background: #f3f4f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; }
        .empty-icon svg { width: 32px; height: 32px; color: #9ca3af; }
        .empty h3 { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
        .empty p { color: #6b7280; margin-bottom: 24px; }
        
        .detail-card { background: white; border-radius: 24px; padding: 24px; margin-bottom: 24px; border: 1px solid #e5e7eb; }
        .detail-top { display: flex; gap: 20px; margin-bottom: 24px; }
        .detail-icon { width: 112px; height: 112px; border-radius: 24px; object-fit: cover; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .detail-title { font-size: 24px; font-weight: bold; margin-bottom: 4px; }
        .detail-author { color: #059669; font-weight: 500; margin-bottom: 8px; }
        .detail-cat { display: inline-flex; align-items: center; gap: 4px; padding: 4px 12px; background: #d1fae5; color: #059669; border-radius: 50px; font-size: 12px; font-weight: 500; }
        .detail-cat svg { width: 12px; height: 12px; }
        .detail-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; padding: 24px 0; border-top: 1px solid #e5e7eb; border-bottom: 1px solid #e5e7eb; margin: 24px 0; }
        .stat { text-align: center; }
        .stat-val { font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 4px; }
        .stat-val svg { width: 16px; height: 16px; }
        .stat-label { font-size: 12px; color: #6b7280; margin-top: 4px; }
        .download-btn { width: 100%; padding: 18px; background: #059669; color: white; border: none; border-radius: 16px; font-size: 18px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 10px 30px rgba(5,150,105,0.3); }
        .download-btn:hover { background: #047857; }
        .download-btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .download-btn svg { width: 20px; height: 20px; }
        
        .screenshots { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 8px; margin-bottom: 24px; }
        .screenshot { width: 180px; height: auto; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); flex-shrink: 0; }
        
        .section { background: white; border-radius: 24px; padding: 24px; margin-bottom: 24px; border: 1px solid #e5e7eb; }
        .section-title { font-size: 18px; font-weight: 600; margin-bottom: 12px; }
        .section-text { color: #4b5563; line-height: 1.6; white-space: pre-wrap; }
        
        .dev-info { display: flex; align-items: center; gap: 12px; }
        .dev-avatar { width: 40px; height: 40px; background: #d1fae5; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .dev-avatar svg { width: 20px; height: 20px; color: #059669; }
        .dev-name { font-weight: 500; }
        .dev-email { font-size: 14px; color: #6b7280; }
        .dev-date { display: flex; align-items: center; gap: 12px; margin-top: 12px; font-size: 14px; color: #6b7280; }
        .dev-date svg { width: 16px; height: 16px; }
        
        .form-section { background: white; border-radius: 16px; padding: 24px; margin-bottom: 16px; border: 1px solid #e5e7eb; }
        .form-label { display: block; font-weight: 600; margin-bottom: 12px; font-size: 16px; }
        .form-label-sm { font-weight: normal; font-size: 14px; color: #374151; margin-bottom: 8px; display: block; }
        .form-input { width: 100%; padding: 12px 16px; border: 1px solid #e5e7eb; border-radius: 12px; font-size: 16px; outline: none; margin-bottom: 16px; }
        .form-input:focus { border-color: #059669; box-shadow: 0 0 0 2px rgba(5,150,105,0.2); }
        .form-textarea { width: 100%; padding: 12px 16px; border: 1px solid #e5e7eb; border-radius: 12px; font-size: 16px; min-height: 120px; resize: vertical; outline: none; font-family: inherit; }
        .form-textarea:focus { border-color: #059669; box-shadow: 0 0 0 2px rgba(5,150,105,0.2); }
        .form-select { width: 100%; padding: 12px 16px; border: 1px solid #e5e7eb; border-radius: 12px; font-size: 16px; outline: none; margin-bottom: 16px; background: white; }
        
        .cat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .cat-option { padding: 16px; border: 2px solid #e5e7eb; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .cat-option:hover { border-color: #a7f3d0; }
        .cat-option.selected { border-color: #059669; background: #ecfdf5; }
        .cat-option svg { width: 24px; height: 24px; margin: 0 auto 8px; color: #9ca3af; display: block; }
        .cat-option.selected svg { color: #059669; }
        .cat-option span { font-size: 14px; font-weight: 500; color: #4b5563; }
        .cat-option.selected span { color: #059669; }
        
        .file-upload { padding: 32px; border: 2px dashed #d1d5db; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .file-upload:hover { border-color: #059669; }
        .file-upload svg { width: 32px; height: 32px; color: #9ca3af; margin-bottom: 8px; }
        .file-upload p { font-size: 14px; color: #6b7280; }
        
        .icon-upload-wrap { display: flex; align-items: center; gap: 16px; }
        .icon-upload { width: 96px; height: 96px; border: 2px dashed #d1d5db; border-radius: 16px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
        .icon-upload:hover { border-color: #059669; }
        .icon-upload svg { width: 24px; height: 24px; color: #9ca3af; margin-bottom: 4px; }
        .icon-upload span { font-size: 12px; color: #6b7280; }
        .icon-preview { width: 96px; height: 96px; border-radius: 16px; object-fit: cover; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .icon-tips { font-size: 14px; color: #6b7280; }
        .icon-tips p { margin-bottom: 4px; }
        
        .ss-upload-wrap { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 8px; }
        .ss-upload { width: 120px; height: 200px; border: 2px dashed #d1d5db; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0; }
        .ss-upload:hover { border-color: #059669; }
        .ss-preview { width: 120px; height: 200px; border-radius: 12px; flex-shrink: 0; position: relative; }
        .ss-preview img { width: 100%; height: 100%; object-fit: cover; border-radius: 12px; }
        .ss-remove { position: absolute; top: -8px; right: -8px; width: 24px; height: 24px; background: #ef4444; color: white; border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .ss-remove svg { width: 14px; height: 14px; }
        
        .profile-card { background: white; border-radius: 24px; padding: 24px; margin-bottom: 24px; border: 1px solid #e5e7eb; }
        .profile-header { display: flex; align-items: center; gap: 16px; margin-bottom: 24px; }
        .profile-avatar { width: 80px; height: 80px; background: linear-gradient(135deg, #34d399, #14b8a6); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 28px; font-weight: bold; box-shadow: 0 10px 30px rgba(5,150,105,0.3); }
        .profile-name { font-size: 20px; font-weight: bold; }
        .profile-email { display: flex; align-items: center; gap: 8px; color: #6b7280; margin-top: 4px; font-size: 14px; }
        .profile-email svg { width: 16px; height: 16px; }
        .profile-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 24px; }
        .profile-stat { background: #f9fafb; border-radius: 12px; padding: 16px; text-align: center; }
        .profile-stat-val { font-size: 24px; font-weight: bold; }
        .profile-stat-label { font-size: 14px; color: #6b7280; }
        
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 100; padding: 16px; }
        .modal-content { background: white; border-radius: 24px; padding: 32px; max-width: 400px; width: 100%; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .modal-header h2 { font-size: 20px; font-weight: bold; }
        .modal-close { background: none; border: none; cursor: pointer; padding: 8px; }
        .modal-close svg { width: 24px; height: 24px; }
        
        .auth-screen { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 16px; }
        .auth-card { background: white; border-radius: 24px; padding: 32px; max-width: 400px; width: 100%; text-align: center; border: 1px solid #e5e7eb; }
        .auth-icon { width: 64px; height: 64px; background: #d1fae5; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; }
        .auth-icon svg { width: 32px; height: 32px; color: #059669; }
        .auth-title { font-size: 20px; font-weight: bold; margin-bottom: 8px; }
        .auth-desc { color: #6b7280; margin-bottom: 24px; }
        .auth-link { display: block; margin-top: 16px; color: #059669; text-decoration: none; }
        
        .file-selected { display: flex; align-items: center; gap: 12px; padding: 16px; background: #ecfdf5; border-radius: 12px; }
        .file-selected svg { width: 32px; height: 32px; color: #059669; }
        .file-selected-info { flex: 1; min-width: 0; }
        .file-selected-name { font-weight: 500; color: #111827; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .file-selected-size { font-size: 14px; color: #6b7280; }
        .file-selected-remove { padding: 8px; background: none; border: none; cursor: pointer; color: #6b7280; }
        .file-selected-remove:hover { color: #ef4444; }
        
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .hidden { display: none !important; }
        .result-count { color: #6b7280; font-size: 14px; margin-bottom: 16px; }
        
        .loading { display: flex; align-items: center; justify-content: center; padding: 60px; }
        .spinner { width: 40px; height: 40px; border: 4px solid #e5e7eb; border-top-color: #059669; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .progress-bar { width: 100%; height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden; margin-top: 12px; }
        .progress-fill { height: 100%; background: #059669; transition: width 0.3s; }
        .upload-status { text-align: center; margin-top: 8px; font-size: 14px; color: #6b7280; }
        
        .warning { background: #fef3c7; border: 1px solid #f59e0b; border-radius: 12px; padding: 12px 16px; margin-bottom: 16px; font-size: 14px; color: #92400e; }
    </style>
</head>
<body>
    <div id="app">
        <div class="loading"><div class="spinner"></div></div>
    </div>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    
    <script>
        // ========== FIREBASE CONFIG ==========
        const firebaseConfig = {
            apiKey: "AIzaSyDO2EKbZYfy6ah_95xDo9m8MRfXtd9BExs",
            authDomain: "streamx-a4099.firebaseapp.com",
            databaseURL: "https://streamx-a4099-default-rtdb.firebaseio.com",
            projectId: "streamx-a4099",
            storageBucket: "streamx-a4099.firebasestorage.app",
            messagingSenderId: "1073155867607",
            appId: "1:1073155867607:web:f4e0496523d360626a0192",
            measurementId: "G-7DX6HDZ3S6"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // ========== ICONS ==========
        const icons = {
            search: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>`,
            plus: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>`,
            home: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>`,
            upload: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>`,
            user: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>`,
            download: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>`,
            phone: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>`,
            book: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>`,
            music: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/></svg>`,
            grid: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/></svg>`,
            back: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>`,
            share: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>`,
            logout: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>`,
            mail: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>`,
            calendar: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>`,
            x: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>`,
            check: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>`,
            image: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>`,
            file: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>`,
            arrow: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>`,
            external: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>`
        };
        
        // ========== STATE ==========
        let apps = [];
        let currentUser = null;
        let currentPage = 'home';
        let currentCategory = 'all';
        let searchQuery = '';
        let selectedAppId = null;
        let isLoading = false;
        let uploadProgress = 0;
        let uploadStatus = '';
        
        // Upload state
        let uploadData = {
            category: 'app',
            downloadType: 'apk',
            iconBase64: null,
            iconPreview: null,
            fileBase64: null,
            fileName: null,
            fileSize: null,
            fileSizeBytes: 0,
            pwaUrl: '',
            screenshotBase64s: [],
            screenshotPreviews: []
        };
        
        // ========== FIREBASE FUNCTIONS ==========
        async function loadAppsFromFirestore() {
            try {
                const snapshot = await db.collection('beelzeApps').orderBy('createdDate', 'desc').get();
                apps = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                render();
            } catch (error) {
                console.error('Error loading apps:', error);
                apps = [];
                render();
            }
        }
        
        async function saveAppToFirestore(appData) {
            try {
                const docRef = await db.collection('beelzeApps').add(appData);
                return docRef.id;
            } catch (error) {
                console.error('Error saving app:', error);
                throw error;
            }
        }
        
        async function updateAppInFirestore(appId, data) {
            try {
                await db.collection('beelzeApps').doc(appId).update(data);
            } catch (error) {
                console.error('Error updating app:', error);
            }
        }
        
        async function saveUserToFirestore(userData) {
            try {
                await db.collection('beelzeUsers').doc(userData.email).set(userData, { merge: true });
            } catch (error) {
                console.error('Error saving user:', error);
            }
        }
        
        async function getUserFromFirestore(email) {
            try {
                const doc = await db.collection('beelzeUsers').doc(email).get();
                return doc.exists ? doc.data() : null;
            } catch (error) {
                console.error('Error getting user:', error);
                return null;
            }
        }
        
        // ========== FILE TO BASE64 ==========
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        function compressImage(file, maxWidth = 400, quality = 0.7) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        resolve(canvas.toDataURL('image/jpeg', quality));
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }
        
        // ========== UTILITIES ==========
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }
        
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }
        
        function getCategoryIcon(cat) {
            if (cat === 'app') return icons.phone;
            if (cat === 'book') return icons.book;
            if (cat === 'music') return icons.music;
            return icons.grid;
        }
        
        function getCategoryLabel(cat) {
            if (cat === 'app') return 'Application';
            if (cat === 'book') return 'Book / PDF';
            if (cat === 'music') return 'Music / Audio';
            return 'All';
        }
        
        function getDownloadTypeLabel(type) {
            if (type === 'apk') return 'APK File';
            if (type === 'pwa') return 'Web App (PWA)';
            if (type === 'pdf') return 'PDF Document';
            if (type === 'audio') return 'Audio File';
            return 'File';
        }
        
        function getFileExtension(type) {
            if (type === 'apk') return '.apk';
            if (type === 'pdf') return '.pdf';
            if (type === 'audio') return '.mp3';
            return '';
        }
        
        function getMimeType(type) {
            if (type === 'apk') return 'application/vnd.android.package-archive';
            if (type === 'pdf') return 'application/pdf';
            if (type === 'audio') return 'audio/mpeg';
            return 'application/octet-stream';
        }
        
        // ========== NAVIGATION ==========
        function navigateTo(page) {
            currentPage = page;
            if (page === 'upload') {
                resetUploadData();
            }
            render();
            window.scrollTo(0, 0);
        }
        
        function setCategory(cat) {
            currentCategory = cat;
            render();
        }
        
        function handleSearch(value) {
            searchQuery = value;
            render();
        }
        
        function viewApp(id) {
            selectedAppId = id;
            currentPage = 'detail';
            render();
            window.scrollTo(0, 0);
        }
        
        // ========== DOWNLOAD FUNCTION ==========
        async function downloadApp(id) {
            const app = apps.find(a => a.id === id);
            if (!app) return;
            
            // Update download count
            const newCount = (app.downloads || 0) + 1;
            await updateAppInFirestore(id, { downloads: newCount });
            app.downloads = newCount;
            render();
            
            if (app.downloadType === 'pwa' && app.downloadUrl) {
                window.open(app.downloadUrl, '_blank');
            } else if (app.fileBase64) {
                // Convert Base64 to Blob and download
                const base64Data = app.fileBase64.split(',')[1];
                const byteCharacters = atob(base64Data);
                const byteNumbers = new Array(byteCharacters.length);
                
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: getMimeType(app.downloadType) });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = app.title.replace(/[^a-z0-9]/gi, '_') + getFileExtension(app.downloadType);
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }
        
        // ========== RENDER: BOTTOM NAV ==========
        function renderBottomNav() {
            return `
                <nav class="bottom-nav">
                    <div class="nav-content">
                        <button class="nav-item ${currentPage === 'home' || currentPage === 'detail' ? 'active' : ''}" onclick="navigateTo('home')">
                            ${icons.home}
                            <span>Home</span>
                        </button>
                        <button class="nav-item ${currentPage === 'upload' ? 'active' : ''}" onclick="navigateTo('upload')">
                            ${icons.upload}
                            <span>Upload</span>
                        </button>
                        <button class="nav-item ${currentPage === 'profile' ? 'active' : ''}" onclick="navigateTo('profile')">
                            ${currentUser ? `<div class="nav-avatar">${(currentUser.name || currentUser.email)[0].toUpperCase()}</div>` : icons.user}
                            <span>Profile</span>
                        </button>
                    </div>
                </nav>
            `;
        }
        
        // ========== RENDER: HOME ==========
        function renderHome() {
            const filtered = apps.filter(app => {
                const matchesCat = currentCategory === 'all' || app.category === currentCategory;
                const matchesSearch = !searchQuery || 
                    app.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    (app.description && app.description.toLowerCase().includes(searchQuery.toLowerCase())) ||
                    (app.tags && app.tags.some(t => t.toLowerCase().includes(searchQuery.toLowerCase())));
                return matchesCat && matchesSearch;
            });
            
            const featured = apps.length > 0 ? [...apps].sort((a, b) => (b.downloads || 0) - (a.downloads || 0))[0] : null;
            
            return `
                <header class="header">
                    <div class="header-content">
                        <div class="header-top">
                            <div>
                                <div class="logo">Beelze Apps</div>
                                <div class="logo-sub">Your alternative app store</div>
                            </div>
                            <button class="btn" onclick="navigateTo('upload')">
                                ${icons.plus}
                                <span>Upload</span>
                            </button>
                        </div>
                        <div class="search-box">
                            ${icons.search}
                            <input type="text" class="search-input" placeholder="Search apps, books, music..." 
                                value="${searchQuery}" oninput="handleSearch(this.value)">
                        </div>
                    </div>
                </header>
                
                <div class="categories">
                    <button class="cat-btn ${currentCategory === 'all' ? 'active' : ''}" onclick="setCategory('all')">
                        ${icons.grid} All
                    </button>
                    <button class="cat-btn ${currentCategory === 'app' ? 'active' : ''}" onclick="setCategory('app')">
                        ${icons.phone} Apps
                    </button>
                    <button class="cat-btn ${currentCategory === 'book' ? 'active' : ''}" onclick="setCategory('book')">
                        ${icons.book} Books
                    </button>
                    <button class="cat-btn ${currentCategory === 'music' ? 'active' : ''}" onclick="setCategory('music')">
                        ${icons.music} Music
                    </button>
                </div>
                
                <main class="main">
                    ${!searchQuery && currentCategory === 'all' && featured ? `
                        <div class="featured" onclick="viewApp('${featured.id}')">
                            <div class="featured-content">
                                <img src="${featured.iconBase64 || 'https://via.placeholder.com/96'}" alt="${featured.title}" class="featured-icon">
                                <div style="flex:1;min-width:0;">
                                    <span class="featured-badge">Featured</span>
                                    <h2 class="featured-title">${featured.title}</h2>
                                    <p class="featured-desc">${featured.shortDesc || (featured.description ? featured.description.substring(0, 80) : '')}</p>
                                    <div class="featured-stats">
                                        <span style="display:flex;align-items:center;gap:4px;">${icons.download} ${formatNumber(featured.downloads || 0)} downloads</span>
                                        <span style="display:flex;align-items:center;gap:4px;">Get it ${icons.arrow}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    ${searchQuery ? `<p class="result-count">${filtered.length} result${filtered.length !== 1 ? 's' : ''} for "${searchQuery}"</p>` : ''}
                    
                    ${filtered.length > 0 ? filtered.map(app => `
                        <div class="app-card" onclick="viewApp('${app.id}')">
                            <div class="app-icon-wrap">
                                <img src="${app.iconBase64 || 'https://via.placeholder.com/80'}" alt="${app.title}" class="app-icon">
                                <div class="app-badge">${getCategoryIcon(app.category)}</div>
                            </div>
                            <div class="app-info">
                                <div class="app-title">${app.title}</div>
                                <div class="app-author">${app.author || 'Unknown Developer'}</div>
                                <div class="app-desc">${app.shortDesc || (app.description ? app.description.substring(0, 60) : '')}</div>
                                <div class="app-stats">
                                    <span style="display:flex;align-items:center;gap:4px;">${icons.download} ${formatNumber(app.downloads || 0)}</span>
                                    ${app.size ? `<span>${app.size}</span>` : ''}
                                </div>
                            </div>
                        </div>
                    `).join('') : `
                        <div class="empty">
                            <div class="empty-icon">${icons.plus}</div>
                            <h3>${searchQuery ? 'No results found' : 'No items yet'}</h3>
                            <p>${searchQuery ? 'Try a different search term' : 'Be the first to upload something!'}</p>
                            <button class="btn" onclick="navigateTo('upload')">
                                ${icons.plus} Upload Now
                            </button>
                        </div>
                    `}
                </main>
                
                ${renderBottomNav()}
            `;
        }
        
        // ========== RENDER: DETAIL ==========
        function renderDetail() {
            const app = apps.find(a => a.id === selectedAppId);
            if (!app) return renderHome();
            
            return `
                <header class="header">
                    <div class="header-content">
                        <div style="display:flex;align-items:center;gap:16px;">
                            <button onclick="navigateTo('home')" style="background:none;border:none;padding:8px;cursor:pointer;">
                                ${icons.back}
                            </button>
                            <h1 style="font-weight:600;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${app.title}</h1>
                            <button onclick="shareApp()" style="background:none;border:none;padding:8px;cursor:pointer;">
                                ${icons.share}
                            </button>
                        </div>
                    </div>
                </header>
                
                <main class="main" style="padding-top:24px;">
                    <div class="detail-card">
                        <div class="detail-top">
                            <img src="${app.iconBase64 || 'https://via.placeholder.com/112'}" alt="${app.title}" class="detail-icon">
                            <div style="flex:1;min-width:0;">
                                <h2 class="detail-title">${app.title}</h2>
                                <p class="detail-author">${app.author || 'Unknown'}</p>
                                <span class="detail-cat">
                                    ${getCategoryIcon(app.category)}
                                    ${getCategoryLabel(app.category)}
                                </span>
                                ${app.shortDesc ? `<p style="color:#6b7280;font-size:14px;margin-top:8px;">${app.shortDesc}</p>` : ''}
                            </div>
                        </div>
                        
                        <div class="detail-stats">
                            <div class="stat">
                                <div class="stat-val">${icons.download} ${formatNumber(app.downloads || 0)}</div>
                                <div class="stat-label">Downloads</div>
                            </div>
                            <div class="stat">
                                <div class="stat-val">${app.size || 'N/A'}</div>
                                <div class="stat-label">Size</div>
                            </div>
                            <div class="stat">
                                <div class="stat-val">${app.version || '1.0'}</div>
                                <div class="stat-label">Version</div>
                            </div>
                        </div>
                        
                        <button class="download-btn" onclick="downloadApp('${app.id}')">
                            ${app.downloadType === 'pwa' ? icons.external : icons.download}
                            ${app.downloadType === 'pwa' ? 'Open App' : 'Download'}
                        </button>
                        <p style="text-align:center;font-size:12px;color:#6b7280;margin-top:12px;">
                            ${getDownloadTypeLabel(app.downloadType)}
                        </p>
                    </div>
                    
                    ${app.screenshots && app.screenshots.length > 0 ? `
                        <div style="margin-bottom:24px;">
                            <h3 class="section-title">Screenshots</h3>
                            <div class="screenshots">
                                ${app.screenshots.map(s => `<img src="${s}" class="screenshot" alt="Screenshot">`).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="section">
                        <h3 class="section-title">About</h3>
                        <p class="section-text">${app.description || 'No description available.'}</p>
                    </div>
                    
                    <div class="section">
                        <h3 class="section-title">Developer</h3>
                        <div class="dev-info">
                            <div class="dev-avatar">${icons.user}</div>
                            <div>
                                <p class="dev-name">${app.author || 'Unknown'}</p>
                                <p class="dev-email">${app.authorEmail || 'No email provided'}</p>
                            </div>
                        </div>
                        ${app.createdDate ? `
                            <div class="dev-date">
                                ${icons.calendar}
                                <span>Published ${formatDate(app.createdDate)}</span>
                            </div>
                        ` : ''}
                    </div>
                </main>
                
                ${renderBottomNav()}
            `;
        }
        
        // ========== RENDER: UPLOAD ==========
        function resetUploadData() {
            uploadData = {
                category: 'app',
                downloadType: 'apk',
                iconBase64: null,
                iconPreview: null,
                fileBase64: null,
                fileName: null,
                fileSize: null,
                fileSizeBytes: 0,
                pwaUrl: '',
                screenshotBase64s: [],
                screenshotPreviews: []
            };
            uploadProgress = 0;
            uploadStatus = '';
        }
        
        function renderUpload() {
            if (!currentUser) {
                return `
                    <div class="auth-screen">
                        <div class="auth-card">
                            <div class="auth-icon">${icons.upload}</div>
                            <h2 class="auth-title">Sign in to Upload</h2>
                            <p class="auth-desc">You need to be signed in to upload apps, books, or music.</p>
                            <button class="btn" style="width:100%;justify-content:center;padding:16px;" onclick="showLoginModal()">
                                Sign In
                            </button>
                            <a href__="#" class="auth-link" onclick="navigateTo('home');return false;">Go back home</a>
                        </div>
                    </div>
                    ${renderBottomNav()}
                `;
            }
            
            const downloadTypes = {
                app: [{ value: 'apk', label: 'APK File' }, { value: 'pwa', label: 'Web App (PWA URL)' }],
                book: [{ value: 'pdf', label: 'PDF Document' }],
                music: [{ value: 'audio', label: 'Audio File' }]
            };
            
            // Check file size warning (Firestore limit ~1MB per document)
            const fileSizeWarning = uploadData.fileSizeBytes > 900000;
            
            return `
                <header class="header">
                    <div class="header-content">
                        <div style="display:flex;align-items:center;gap:16px;">
                            <button onclick="navigateTo('home')" style="background:none;border:none;padding:8px;cursor:pointer;">
                                ${icons.back}
                            </button>
                            <h1 style="font-weight:600;">Upload New Item</h1>
                        </div>
                    </div>
                </header>
                
                <main class="main" style="padding-top:24px;">
                    <div class="warning">
                        ⚠️ File size limit: ~1MB per app. For larger files, use PWA (link) option.
                    </div>
                    
                    <form id="uploadForm" onsubmit="handleUpload(event)">
                        <!-- Category -->
                        <div class="form-section">
                            <label class="form-label">What are you uploading?</label>
                            <div class="cat-grid">
                                <div class="cat-option ${uploadData.category === 'app' ? 'selected' : ''}" onclick="selectCategory('app')">
                                    ${icons.phone}
                                    <span>App</span>
                                </div>
                                <div class="cat-option ${uploadData.category === 'book' ? 'selected' : ''}" onclick="selectCategory('book')">
                                    ${icons.book}
                                    <span>Book / PDF</span>
                                </div>
                                <div class="cat-option ${uploadData.category === 'music' ? 'selected' : ''}" onclick="selectCategory('music')">
                                    ${icons.music}
                                    <span>Music</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Icon -->
                        <div class="form-section">
                            <label class="form-label">Icon / Cover Image *</label>
                            <div class="icon-upload-wrap">
                                ${uploadData.iconPreview ? `
                                    <div style="position:relative;">
                                        <img src="${uploadData.iconPreview}" class="icon-preview" alt="Icon">
                                        <button type="button" onclick="removeIcon()" style="position:absolute;top:-8px;right:-8px;width:24px;height:24px;background:#ef4444;color:white;border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;">
                                            ${icons.x}
                                        </button>
                                    </div>
                                ` : `
                                    <label class="icon-upload">
                                        ${icons.image}
                                        <span>Add Icon</span>
                                        <input type="file" accept="image/*" style="display:none;" onchange="handleIconSelect(this)">
                                    </label>
                                `}
                                <div class="icon-tips">
                                    <p>Square image recommended</p>
                                    <p>Will be compressed automatically</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Basic Info -->
                        <div class="form-section">
                            <label class="form-label-sm">Title *</label>
                            <input type="text" name="title" class="form-input" placeholder="My Awesome App" required>
                            
                            <label class="form-label-sm">Short Description</label>
                            <input type="text" name="shortDesc" class="form-input" placeholder="A brief tagline" maxlength="80">
                            
                            <label class="form-label-sm">Full Description</label>
                            <textarea name="description" class="form-textarea" placeholder="Describe what your app does..."></textarea>
                            
                            <div class="grid-2">
                                <div>
                                    <label class="form-label-sm">Version</label>
                                    <input type="text" name="version" class="form-input" placeholder="1.0.0" value="1.0">
                                </div>
                                <div>
                                    <label class="form-label-sm">Tags</label>
                                    <input type="text" name="tags" class="form-input" placeholder="productivity, tools">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Download File -->
                        <div class="form-section">
                            <label class="form-label">Download File *</label>
                            
                            <label class="form-label-sm">File Type</label>
                            <select name="downloadType" class="form-select" onchange="selectDownloadType(this.value)">
                                ${downloadTypes[uploadData.category].map(t => `
                                    <option value="${t.value}" ${uploadData.downloadType === t.value ? 'selected' : ''}>${t.label}</option>
                                `).join('')}
                            </select>
                            
                            ${uploadData.downloadType === 'pwa' ? `
                                <label class="form-label-sm">PWA / Website URL</label>
                                <input type="url" name="pwaUrl" class="form-input" placeholder="https://myapp.com" value="${uploadData.pwaUrl}" required>
                            ` : `
                                ${uploadData.fileBase64 ? `
                                    <div class="file-selected" ${fileSizeWarning ? 'style="background:#fef3c7;border:1px solid #f59e0b;"' : ''}>
                                        ${icons.file}
                                        <div class="file-selected-info">
                                            <div class="file-selected-name">${uploadData.fileName}</div>
                                            <div class="file-selected-size" ${fileSizeWarning ? 'style="color:#92400e;"' : ''}>${uploadData.fileSize} ${fileSizeWarning ? '(Too large!)' : ''}</div>
                                        </div>
                                        <button type="button" class="file-selected-remove" onclick="removeFile()">
 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beelze Apps - Alternative App Store</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f9fafb; color: #111827; min-height: 100vh; }
        
        .header { background: white; padding: 16px; border-bottom: 1px solid #e5e7eb; position: sticky; top: 0; z-index: 50; }
        .header-content { max-width: 768px; margin: 0 auto; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .logo { font-size: 24px; font-weight: bold; background: linear-gradient(to right, #059669, #0d9488); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .logo-sub { font-size: 12px; color: #6b7280; }
        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 16px; background: #059669; color: white; border: none; border-radius: 12px; font-weight: 500; cursor: pointer; font-size: 14px; }
        .btn:hover { background: #047857; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-outline { background: white; color: #374151; border: 1px solid #e5e7eb; }
        .btn-outline:hover { background: #f9fafb; }
        
        .search-box { position: relative; }
        .search-box svg { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; color: #9ca3af; }
        .search-input { width: 100%; padding: 14px 16px 14px 48px; background: #f3f4f6; border: none; border-radius: 16px; font-size: 16px; outline: none; }
        .search-input:focus { background: white; box-shadow: 0 0 0 2px #059669; }
        
        .categories { display: flex; gap: 8px; padding: 16px; max-width: 768px; margin: 0 auto; overflow-x: auto; }
        .cat-btn { display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: #f3f4f6; border: none; border-radius: 50px; font-weight: 500; font-size: 14px; color: #4b5563; cursor: pointer; white-space: nowrap; }
        .cat-btn.active { background: #059669; color: white; box-shadow: 0 4px 12px rgba(5,150,105,0.3); }
        .cat-btn svg { width: 16px; height: 16px; }
        
        .main { max-width: 768px; margin: 0 auto; padding: 0 16px 100px; }
        
        .featured { background: linear-gradient(135deg, #059669, #0d9488); border-radius: 24px; padding: 24px; color: white; margin-bottom: 24px; box-shadow: 0 10px 40px rgba(5,150,105,0.3); cursor: pointer; }
        .featured-content { display: flex; gap: 20px; }
        .featured-icon { width: 96px; height: 96px; border-radius: 20px; object-fit: cover; box-shadow: 0 10px 30px rgba(0,0,0,0.2); background: rgba(255,255,255,0.2); }
        .featured-badge { display: inline-block; padding: 4px 12px; background: rgba(255,255,255,0.2); border-radius: 50px; font-size: 12px; margin-bottom: 8px; }
        .featured-title { font-size: 20px; font-weight: bold; margin-bottom: 4px; }
        .featured-desc { color: rgba(255,255,255,0.8); font-size: 14px; margin-bottom: 12px; }
        .featured-stats { display: flex; align-items: center; gap: 16px; font-size: 14px; }
        
        .app-card { background: white; border-radius: 16px; padding: 16px; margin-bottom: 12px; border: 1px solid #e5e7eb; display: flex; gap: 16px; cursor: pointer; transition: all 0.2s; }
        .app-card:hover { box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-color: #a7f3d0; transform: translateY(-2px); }
        .app-icon-wrap { position: relative; flex-shrink: 0; }
        .app-icon { width: 80px; height: 80px; border-radius: 16px; object-fit: cover; box-shadow: 0 4px 12px rgba(0,0,0,0.1); background: #f3f4f6; }
        .app-badge { position: absolute; bottom: -4px; right: -4px; padding: 6px; background: #d1fae5; border-radius: 8px; }
        .app-badge svg { width: 12px; height: 12px; color: #059669; }
        .app-info { flex: 1; min-width: 0; }
        .app-title { font-weight: 600; color: #111827; margin-bottom: 2px; }
        .app-author { font-size: 14px; color: #6b7280; margin-bottom: 4px; }
        .app-desc { font-size: 12px; color: #9ca3af; margin-bottom: 8px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .app-stats { display: flex; align-items: center; gap: 12px; font-size: 12px; color: #6b7280; }
        .app-stats svg { width: 12px; height: 12px; }
        
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #e5e7eb; padding: 8px 0 env(safe-area-inset-bottom); z-index: 50; }
        .nav-content { max-width: 768px; margin: 0 auto; display: flex; justify-content: space-around; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px 24px; color: #6b7280; text-decoration: none; font-size: 12px; font-weight: 500; cursor: pointer; border: none; background: none; }
        .nav-item.active { color: #059669; }
        .nav-item svg { width: 24px; height: 24px; }
        .nav-avatar { width: 24px; height: 24px; background: linear-gradient(135deg, #34d399, #14b8a6); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; font-weight: bold; }
        
        .empty { text-align: center; padding: 60px 20px; }
        .empty-icon { width: 80px; height: 80px; background: #f3f4f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; }
        .empty-icon svg { width: 32px; height: 32px; color: #9ca3af; }
        .empty h3 { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
        .empty p { color: #6b7280; margin-bottom: 24px; }
        
        .detail-card { background: white; border-radius: 24px; padding: 24px; margin-bottom: 24px; border: 1px solid #e5e7eb; }
        .detail-top { display: flex; gap: 20px; margin-bottom: 24px; }
        .detail-icon { width: 112px; height: 112px; border-radius: 24px; object-fit: cover; box-shadow: 0 10px 30px rgba(0,0,0,0.15); background: #f3f4f6; }
        .detail-title { font-size: 24px; font-weight: bold; margin-bottom: 4px; }
        .detail-author { color: #059669; font-weight: 500; margin-bottom: 8px; }
        .detail-cat { display: inline-flex; align-items: center; gap: 4px; padding: 4px 12px; background: #d1fae5; color: #059669; border-radius: 50px; font-size: 12px; font-weight: 500; }
        .detail-cat svg { width: 12px; height: 12px; }
        .detail-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; padding: 24px 0; border-top: 1px solid #e5e7eb; border-bottom: 1px solid #e5e7eb; margin: 24px 0; }
        .stat { text-align: center; }
        .stat-val { font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 4px; }
        .stat-val svg { width: 16px; height: 16px; }
        .stat-label { font-size: 12px; color: #6b7280; margin-top: 4px; }
        .download-btn { width: 100%; padding: 18px; background: #059669; color: white; border: none; border-radius: 16px; font-size: 18px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 10px 30px rgba(5,150,105,0.3); }
        .download-btn:hover { background: #047857; }
        .download-btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .download-btn svg { width: 20px; height: 20px; }
        
        .screenshots { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 8px; margin-bottom: 24px; }
        .screenshot { width: 180px; height: auto; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); flex-shrink: 0; background: #f3f4f6; }
        
        .section { background: white; border-radius: 24px; padding: 24px; margin-bottom: 24px; border: 1px solid #e5e7eb; }
        .section-title { font-size: 18px; font-weight: 600; margin-bottom: 12px; }
        .section-text { color: #4b5563; line-height: 1.6; white-space: pre-wrap; }
        
        .dev-info { display: flex; align-items: center; gap: 12px; }
        .dev-avatar { width: 40px; height: 40px; background: #d1fae5; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .dev-avatar svg { width: 20px; height: 20px; color: #059669; }
        .dev-name { font-weight: 500; }
        .dev-email { font-size: 14px; color: #6b7280; }
        .dev-date { display: flex; align-items: center; gap: 12px; margin-top: 12px; font-size: 14px; color: #6b7280; }
        .dev-date svg { width: 16px; height: 16px; }
        
        .form-section { background: white; border-radius: 16px; padding: 24px; margin-bottom: 16px; border: 1px solid #e5e7eb; }
        .form-label { display: block; font-weight: 600; margin-bottom: 12px; font-size: 16px; }
        .form-label-sm { font-weight: normal; font-size: 14px; color: #374151; margin-bottom: 8px; display: block; }
        .form-input { width: 100%; padding: 12px 16px; border: 1px solid #e5e7eb; border-radius: 12px; font-size: 16px; outline: none; margin-bottom: 16px; }
        .form-input:focus { border-color: #059669; box-shadow: 0 0 0 2px rgba(5,150,105,0.2); }
        .form-textarea { width: 100%; padding: 12px 16px; border: 1px solid #e5e7eb; border-radius: 12px; font-size: 16px; min-height: 120px; resize: vertical; outline: none; font-family: inherit; }
        .form-textarea:focus { border-color: #059669; box-shadow: 0 0 0 2px rgba(5,150,105,0.2); }
        .form-select { width: 100%; padding: 12px 16px; border: 1px solid #e5e7eb; border-radius: 12px; font-size: 16px; outline: none; margin-bottom: 16px; background: white; }
        
        .cat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .cat-option { padding: 16px; border: 2px solid #e5e7eb; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .cat-option:hover { border-color: #a7f3d0; }
        .cat-option.selected { border-color: #059669; background: #ecfdf5; }
        .cat-option svg { width: 24px; height: 24px; margin: 0 auto 8px; color: #9ca3af; display: block; }
        .cat-option.selected svg { color: #059669; }
        .cat-option span { font-size: 14px; font-weight: 500; color: #4b5563; }
        .cat-option.selected span { color: #059669; }
        
        .file-upload { padding: 32px; border: 2px dashed #d1d5db; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .file-upload:hover { border-color: #059669; }
        .file-upload svg { width: 32px; height: 32px; color: #9ca3af; margin-bottom: 8px; }
        .file-upload p { font-size: 14px; color: #6b7280; }
        
        .icon-upload-wrap { display: flex; align-items: center; gap: 16px; }
        .icon-upload { width: 96px; height: 96px; border: 2px dashed #d1d5db; border-radius: 16px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
        .icon-upload:hover { border-color: #059669; }
        .icon-upload svg { width: 24px; height: 24px; color: #9ca3af; margin-bottom: 4px; }
        .icon-upload span { font-size: 12px; color: #6b7280; }
        .icon-preview { width: 96px; height: 96px; border-radius: 16px; object-fit: cover; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .icon-tips { font-size: 14px; color: #6b7280; }
        .icon-tips p { margin-bottom: 4px; }
        
        .ss-upload-wrap { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 8px; }
        .ss-upload { width: 120px; height: 200px; border: 2px dashed #d1d5db; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0; }
        .ss-upload:hover { border-color: #059669; }
        .ss-preview { width: 120px; height: 200px; border-radius: 12px; flex-shrink: 0; position: relative; }
        .ss-preview img { width: 100%; height: 100%; object-fit: cover; border-radius: 12px; }
        .ss-remove { position: absolute; top: -8px; right: -8px; width: 24px; height: 24px; background: #ef4444; color: white; border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .ss-remove svg { width: 14px; height: 14px; }
        
        .profile-card { background: white; border-radius: 24px; padding: 24px; margin-bottom: 24px; border: 1px solid #e5e7eb; }
        .profile-header { display: flex; align-items: center; gap: 16px; margin-bottom: 24px; }
        .profile-avatar { width: 80px; height: 80px; background: linear-gradient(135deg, #34d399, #14b8a6); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 28px; font-weight: bold; box-shadow: 0 10px 30px rgba(5,150,105,0.3); }
        .profile-name { font-size: 20px; font-weight: bold; }
        .profile-email { display: flex; align-items: center; gap: 8px; color: #6b7280; margin-top: 4px; font-size: 14px; }
        .profile-email svg { width: 16px; height: 16px; }
        .profile-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 24px; }
        .profile-stat { background: #f9fafb; border-radius: 12px; padding: 16px; text-align: center; }
        .profile-stat-val { font-size: 24px; font-weight: bold; }
        .profile-stat-label { font-size: 14px; color: #6b7280; }
        
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 100; padding: 16px; }
        .modal-content { background: white; border-radius: 24px; padding: 32px; max-width: 400px; width: 100%; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .modal-header h2 { font-size: 20px; font-weight: bold; }
        .modal-close { background: none; border: none; cursor: pointer; padding: 8px; }
        .modal-close svg { width: 24px; height: 24px; }
        
        .auth-screen { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 16px; }
        .auth-card { background: white; border-radius: 24px; padding: 32px; max-width: 400px; width: 100%; text-align: center; border: 1px solid #e5e7eb; }
        .auth-icon { width: 64px; height: 64px; background: #d1fae5; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; }
        .auth-icon svg { width: 32px; height: 32px; color: #059669; }
        .auth-title { font-size: 20px; font-weight: bold; margin-bottom: 8px; }
        .auth-desc { color: #6b7280; margin-bottom: 24px; }
        .auth-link { display: block; margin-top: 16px; color: #059669; text-decoration: none; }
        
        .file-selected { display: flex; align-items: center; gap: 12px; padding: 16px; background: #ecfdf5; border-radius: 12px; }
        .file-selected svg { width: 32px; height: 32px; color: #059669; }
        .file-selected-info { flex: 1; min-width: 0; }
        .file-selected-name { font-weight: 500; color: #111827; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .file-selected-size { font-size: 14px; color: #6b7280; }
        .file-selected-remove { padding: 8px; background: none; border: none; cursor: pointer; color: #6b7280; }
        .file-selected-remove:hover { color: #ef4444; }
        
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .hidden { display: none !important; }
        .result-count { color: #6b7280; font-size: 14px; margin-bottom: 16px; }
        
        .loading { display: flex; align-items: center; justify-content: center; padding: 60px; }
        .spinner { width: 40px; height: 40px; border: 4px solid #e5e7eb; border-top-color: #059669; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .progress-bar { width: 100%; height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden; margin-top: 12px; }
        .progress-fill { height: 100%; background: #059669; transition: width 0.3s; }
        .upload-status { text-align: center; margin-top: 8px; font-size: 14px; color: #6b7280; }
    </style>
</head>
<body>
    <div id="app">
        <div class="loading"><div class="spinner"></div></div>
    </div>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage-compat.js"></script>
    
    <script>
        // ========== FIREBASE CONFIG ==========
        const firebaseConfig = {
            apiKey: "AIzaSyDO2EKbZYfy6ah_95xDo9m8MRfXtd9BExs",
            authDomain: "streamx-a4099.firebaseapp.com",
            databaseURL: "https://streamx-a4099-default-rtdb.firebaseio.com",
            projectId: "streamx-a4099",
            storageBucket: "streamx-a4099.firebasestorage.app",
            messagingSenderId: "1073155867607",
            appId: "1:1073155867607:web:f4e0496523d360626a0192",
            measurementId: "G-7DX6HDZ3S6"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        
        // ========== ICONS ==========
        const icons = {
            search: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>`,
            plus: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>`,
            home: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>`,
            upload: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>`,
            user: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>`,
            download: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>`,
            phone: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>`,
            book: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>`,
            music: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/></svg>`,
            grid: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/></svg>`,
            back: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>`,
            share: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>`,
            logout: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>`,
            mail: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>`,
            calendar: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>`,
            x: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>`,
            check: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>`,
            image: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>`,
            file: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>`,
            arrow: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>`,
            external: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>`
        };
        
        // ========== STATE ==========
        let apps = [];
        let currentUser = null;
        let currentPage = 'home';
        let currentCategory = 'all';
        let searchQuery = '';
        let selectedAppId = null;
        let isLoading = false;
        let uploadProgress = 0;
        let uploadStatus = '';
        
        // Upload state
        let uploadData = {
            category: 'app',
            downloadType: 'apk',
            iconFile: null,
            iconPreview: null,
            appFile: null,
            fileName: null,
            fileSize: null,
            pwaUrl: '',
            screenshotFiles: [],
            screenshotPreviews: []
        };
        
        // ========== FIREBASE FUNCTIONS ==========
        async function loadAppsFromFirestore() {
            try {
                const snapshot = await db.collection('beelzeApps').orderBy('createdDate', 'desc').get();
                apps = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                render();
            } catch (error) {
                console.error('Error loading apps:', error);
                apps = [];
                render();
            }
        }
        
        async function saveAppToFirestore(appData) {
            const docRef = await db.collection('beelzeApps').add(appData);
            return docRef.id;
        }
        
        async function updateAppInFirestore(appId, data) {
            await db.collection('beelzeApps').doc(appId).update(data);
        }
        
        async function saveUserToFirestore(userData) {
            await db.collection('beelzeUsers').doc(userData.email).set(userData, { merge: true });
        }
        
        // Upload file using Base64 method to avoid CORS
        async function uploadFileToStorage(file, path) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = async (e) => {
                    try {
                        const base64 = e.target.result.split(',')[1];
                        const storageRef = storage.ref(path);
                        
                        // Use putString with base64 format - this avoids CORS preflight
                        const metadata = { contentType: file.type };
                        const snapshot = await storageRef.putString(base64, 'base64', metadata);
                        const downloadURL = await snapshot.ref.getDownloadURL();
                        resolve(downloadURL);
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // ========== UTILITIES ==========
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return (num || 0).toString();
        }
        
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }
        
        function getCategoryIcon(cat) {
            if (cat === 'app') return icons.phone;
            if (cat === 'book') return icons.book;
            if (cat === 'music') return icons.music;
            return icons.grid;
        }
        
        function getCategoryLabel(cat) {
            if (cat === 'app') return 'Application';
            if (cat === 'book') return 'Book / PDF';
            if (cat === 'music') return 'Music / Audio';
            return 'All';
        }
        
        function getDownloadTypeLabel(type) {
            if (type === 'apk') return 'APK File';
            if (type === 'pwa') return 'Web App (PWA)';
            if (type === 'pdf') return 'PDF Document';
            if (type === 'audio') return 'Audio File';
            return 'File';
        }
        
        function getFileExtension(type) {
            if (type === 'apk') return '.apk';
            if (type === 'pdf') return '.pdf';
            if (type === 'audio') return '.mp3';
            return '';
        }
        
        // ========== NAVIGATION ==========
        function navigateTo(page) {
            currentPage = page;
            if (page === 'upload') resetUploadData();
            render();
            window.scrollTo(0, 0);
        }
        
        function setCategory(cat) {
            currentCategory = cat;
            render();
        }
        
        function handleSearch(value) {
            searchQuery = value;
            render();
        }
        
        function viewApp(id) {
            selectedAppId = id;
            currentPage = 'detail';
            render();
            window.scrollTo(0, 0);
        }
        
        // ========== DOWNLOAD FUNCTION ==========
        async function downloadApp(id) {
            const app = apps.find(a => a.id === id);
            if (!app) return;
            
            // Update download count
            const newCount = (app.downloads || 0) + 1;
            await updateAppInFirestore(id, { downloads: newCount });
            app.downloads = newCount;
            render();
            
            if (app.downloadType === 'pwa') {
                window.open(app.downloadUrl, '_blank');
            } else if (app.downloadUrl) {
                // Direct download - opens in new tab and triggers download
                const a = document.createElement('a');
                a.href = app.downloadUrl;
                a.target = '_blank';
                a.download = app.title.replace(/[^a-z0-9]/gi, '_') + getFileExtension(app.downloadType);
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
        }
        
        // ========== RENDER: BOTTOM NAV ==========
        function renderBottomNav() {
            return `
                <nav class="bottom-nav">
                    <div class="nav-content">
                        <button class="nav-item ${currentPage === 'home' || currentPage === 'detail' ? 'active' : ''}" onclick="navigateTo('home')">
                            ${icons.home}
                            <span>Home</span>
                        </button>
                        <button class="nav-item ${currentPage === 'upload' ? 'active' : ''}" onclick="navigateTo('upload')">
                            ${icons.upload}
                            <span>Upload</span>
                        </button>
                        <button class="nav-item ${currentPage === 'profile' ? 'active' : ''}" onclick="navigateTo('profile')">
                            ${currentUser ? `<div class="nav-avatar">${(currentUser.name || currentUser.email)[0].toUpperCase()}</div>` : icons.user}
                            <span>Profile</span>
                        </button>
                    </div>
                </nav>
            `;
        }
        
        // ========== RENDER: HOME ==========
        function renderHome() {
            const filtered = apps.filter(app => {
                const matchesCat = currentCategory === 'all' || app.category === currentCategory;
                const matchesSearch = !searchQuery || 
                    app.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    (app.description && app.description.toLowerCase().includes(searchQuery.toLowerCase()));
                return matchesCat && matchesSearch;
            });
            
            const featured = apps.length > 0 ? [...apps].sort((a, b) => (b.downloads || 0) - (a.downloads || 0))[0] : null;
            
            return `
                <header class="header">
                    <div class="header-content">
                        <div class="header-top">
                            <div>
                                <div class="logo">Beelze Apps</div>
                                <div class="logo-sub">Your alternative app store</div>
                            </div>
                            <button class="btn" onclick="navigateTo('upload')">
                                ${icons.plus}
                                <span>Upload</span>
                            </button>
                        </div>
                        <div class="search-box">
                            ${icons.search}
                            <input type="text" class="search-input" placeholder="Search apps, books, music..." 
                                value="${searchQuery}" oninput="handleSearch(this.value)">
                        </div>
                    </div>
                </header>
                
                <div class="categories">
                    <button class="cat-btn ${currentCategory === 'all' ? 'active' : ''}" onclick="setCategory('all')">${icons.grid} All</button>
                    <button class="cat-btn ${currentCategory === 'app' ? 'active' : ''}" onclick="setCategory('app')">${icons.phone} Apps</button>
                    <button class="cat-btn ${currentCategory === 'book' ? 'active' : ''}" onclick="setCategory('book')">${icons.book} Books</button>
                    <button class="cat-btn ${currentCategory === 'music' ? 'active' : ''}" onclick="setCategory('music')">${icons.music} Music</button>
                </div>
                
                <main class="main">
                    ${!searchQuery && currentCategory === 'all' && featured ? `
                        <div class="featured" onclick="viewApp('${featured.id}')">
                            <div class="featured-content">
                                <img src="${featured.iconUrl || ''}" alt="${featured.title}" class="featured-icon" onerror="this.style.display='none'">
                                <div style="flex:1;min-width:0;">
                                    <span class="featured-badge">Featured</span>
                                    <h2 class="featured-title">${featured.title}</h2>
                                    <p class="featured-desc">${featured.shortDesc || ''}</p>
                                    <div class="featured-stats">
                                        <span style="display:flex;align-items:center;gap:4px;">${icons.download} ${formatNumber(featured.downloads)} downloads</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    ${filtered.length > 0 ? filtered.map(app => `
                        <div class="app-card" onclick="viewApp('${app.id}')">
                            <div class="app-icon-wrap">
                                <img src="${app.iconUrl || ''}" alt="${app.title}" class="app-icon" onerror="this.style.background='#e5e7eb'">
                                <div class="app-badge">${getCategoryIcon(app.category)}</div>
                            </div>
                            <div class="app-info">
                                <div class="app-title">${app.title}</div>
                                <div class="app-author">${app.author || 'Unknown'}</div>
                                <div class="app-desc">${app.shortDesc || ''}</div>
                                <div class="app-stats">
                                    <span style="display:flex;align-items:center;gap:4px;">${icons.download} ${formatNumber(app.downloads)}</span>
                                    ${app.size ? `<span>${app.size}</span>` : ''}
                                </div>
                            </div>
                        </div>
                    `).join('') : `
                        <div class="empty">
                            <div class="empty-icon">${icons.plus}</div>
                            <h3>No items yet</h3>
                            <p>Be the first to upload something!</p>
                            <button class="btn" onclick="navigateTo('upload')">${icons.plus} Upload Now</button>
                        </div>
                    `}
                </main>
                ${renderBottomNav()}
            `;
        }
        
        // ========== RENDER: DETAIL ==========
        function renderDetail() {
            const app = apps.find(a => a.id === selectedAppId);
            if (!app) return renderHome();
            
            return `
                <header class="header">
                    <div class="header-content">
                        <div style="display:flex;align-items:center;gap:16px;">
                            <button onclick="navigateTo('home')" style="background:none;border:none;padding:8px;cursor:pointer;">${icons.back}</button>
                            <h1 style="font-weight:600;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${app.title}</h1>
                            <button onclick="shareApp()" style="background:none;border:none;padding:8px;cursor:pointer;">${icons.share}</button>
                        </div>
                    </div>
                </header>
                
                <main class="main" style="padding-top:24px;">
                    <div class="detail-card">
                        <div class="detail-top">
                            <img src="${app.iconUrl || ''}" alt="${app.title}" class="detail-icon" onerror="this.style.background='#e5e7eb'">
                            <div style="flex:1;min-width:0;">
                                <h2 class="detail-title">${app.title}</h2>
                                <p class="detail-author">${app.author || 'Unknown'}</p>
                                <span class="detail-cat">${getCategoryIcon(app.category)} ${getCategoryLabel(app.category)}</span>
                            </div>
                        </div>
                        
                        <div class="detail-stats">
                            <div class="stat">
                                <div class="stat-val">${icons.download} ${formatNumber(app.downloads)}</div>
                                <div class="stat-label">Downloads</div>
                            </div>
                            <div class="stat">
                                <div class="stat-val">${app.size || 'N/A'}</div>
                                <div class="stat-label">Size</div>
                            </div>
                            <div class="stat">
                                <div class="stat-val">${app.version || '1.0'}</div>
                                <div class="stat-label">Version</div>
                            </div>
                        </div>
                        
                        <button class="download-btn" onclick="downloadApp('${app.id}')">
                            ${app.downloadType === 'pwa' ? icons.external : icons.download}
                            ${app.downloadType === 'pwa' ? 'Open App' : 'Download'}
                        </button>
                        <p style="text-align:center;font-size:12px;color:#6b7280;margin-top:12px;">${getDownloadTypeLabel(app.downloadType)}</p>
                    </div>
                    
                    ${app.screenshots && app.screenshots.length > 0 ? `
                        <div style="margin-bottom:24px;">
                            <h3 class="section-title">Screenshots</h3>
                            <div class="screenshots">
                                ${app.screenshots.map(s => `<img src="${s}" class="screenshot" alt="Screenshot">`).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="section">
                        <h3 class="section-title">About</h3>
                        <p class="section-text">${app.description || 'No description available.'}</p>
                    </div>
                    
                    <div class="section">
                        <h3 class="section-title">Developer</h3>
                        <div class="dev-info">
                            <div class="dev-avatar">${icons.user}</div>
                            <div>
                                <p class="dev-name">${app.author || 'Unknown'}</p>
                                <p class="dev-email">${app.authorEmail || ''}</p>
                            </div>
                        </div>
                        ${app.createdDate ? `<div class="dev-date">${icons.calendar} <span>Published ${formatDate(app.createdDate)}</span></div>` : ''}
                    </div>
                </main>
                ${renderBottomNav()}
            `;
        }
        
        // ========== RENDER: UPLOAD ==========
        function resetUploadData() {
            uploadData = { category: 'app', downloadType: 'apk', iconFile: null, iconPreview: null, appFile: null, fileName: null, fileSize: null, pwaUrl: '', screenshotFiles: [], screenshotPreviews: [] };
            uploadProgress = 0;
            uploadStatus = '';
        }
        
        function renderUpload() {
            if (!currentUser) {
                return `
                    <div class="auth-screen">
                        <div class="auth-card">
                            <div class="auth-icon">${icons.upload}</div>
                            <h2 class="auth-title">Sign in to Upload</h2>
                            <p class="auth-desc">You need to be signed in to upload apps, books, or music.</p>
                            <button class="btn" style="width:100%;justify-content:center;padding:16px;" onclick="showLoginModal()">Sign In</button>
                            <a href__="#" class="auth-link" onclick="navigateTo('home');return false;">Go back home</a>
                        </div>
                    </div>
                    ${renderBottomNav()}
                `;
            }
            
            const downloadTypes = {
                app: [{ value: 'apk', label: 'APK File' }, { value: 'pwa', label: 'Web App (PWA URL)' }],
                book: [{ value: 'pdf', label: 'PDF Document' }],
                music: [{ value: 'audio', label: 'Audio File' }]
            };
            
            return `
                <header class="header">
                    <div class="header-content">
                        <div style="display:flex;align-items:center;gap:16px;">
                            <button onclick="navigateTo('home')" style="background:none;border:none;padding:8px;cursor:pointer;">${icons.back}</button>
                            <h1 style="font-weight:600;">Upload New Item</h1>
                        </div>
                    </div>
                </header>
                
                <main class="main" style="padding-top:24px;">
                    <form id="uploadForm" onsubmit="handleUpload(event)">
                        <div class="form-section">
                            <label class="form-label">What are you uploading?</label>
                            <div class="cat-grid">
                                <div class="cat-option ${uploadData.category === 'app' ? 'selected' : ''}" onclick="selectCategory('app')">${icons.phone}<span>App</span></div>
                                <div class="cat-option ${uploadData.category === 'book' ? 'selected' : ''}" onclick="selectCategory('book')">${icons.book}<span>Book</span></div>
                                <div class="cat-option ${uploadData.category === 'music' ? 'selected' : ''}" onclick="selectCategory('music')">${icons.music}<span>Music</span></div>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <label class="form-label">Icon / Cover *</label>
                            <div class="icon-upload-wrap">
                                ${uploadData.iconPreview ? `
                                    <div style="position:relative;">
                                        <img src="${uploadData.iconPreview}" class="icon-preview" alt="Icon">
                                        <button type="button" onclick="removeIcon()" style="position:absolute;top:-8px;right:-8px;width:24px;height:24px;background:#ef4444;color:white;border:none;border-radius:50%;cursor:pointer;">${icons.x}</button>
                                    </div>
                                ` : `
                                    <label class="icon-upload">
                                        ${icons.image}<span>Add Icon</span>
                                        <input type="file" accept="image/*" style="display:none;" onchange="handleIconSelect(this)">
                                    </label>
                                `}
                                <div class="icon-tips"><p>Square image</p><p>PNG or JPG</p></div>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <label class="form-label-sm">Title *</label>
                            <input type="text" name="title" class="form-input" placeholder="My Awesome App" required>
                            <label class="form-label-sm">Short Description</label>
                            <input type="text" name="shortDesc" class="form-input" placeholder="A brief tagline" maxlength="80">
                            <label class="form-label-sm">Full Description</label>
                            <textarea name="description" class="form-textarea" placeholder="Describe your app..."></textarea>
                            <div class="grid-2">
                                <div><label class="form-label-sm">Version</label><input type="text" name="version" class="form-input" placeholder="1.0" value="1.0"></div>
                                <div><label class="form-label-sm">Tags</label><input type="text" name="tags" class="form-input" placeholder="tools, productivity"></div>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <label class="form-label">Download File *</label>
                            <label class="form-label-sm">File Type</label>
                            <select name="downloadType" class="form-select" onchange="selectDownloadType(this.value)">
                                ${downloadTypes[uploadData.category].map(t => `<option value="${t.value}" ${uploadData.downloadType === t.value ? 'selected' : ''}>${t.label}</option>`).join('')}
                            </select>
                            
                            ${uploadData.downloadType === 'pwa' ? `
                                <label class="form-label-sm">PWA / Website URL</label>
                                <input type="url" name="pwaUrl" class="form-input" placeholder="https://myapp.com" required>
                            ` : `
                                ${uploadData.appFile ? `
                                    <div class="file-selected">
                                        ${icons.file}
                                        <div class="file-selected-info">
                                            <div class="file-selected-name">${uploadData.fileName}</div>
                                            <div class="file-selected-size">${uploadData.fileSize}</div>
                                        </div>
                                        <button type="button" class="file-selected-remove" onclick="removeFile()">${icons.x}</button>
                                    </div>
                                ` : `
                                    <label class="file-upload">
                                        ${icons.upload}
                                        <p style="font-weight:500;color:#374151;">Click to upload file</p>
                                        <p>Any size supported</p>
                                        <input type="file" style="display:none;" onchange="handleFileSelect(this)" accept="${uploadData.category === 'app' ? '.apk' : uploadData.category === 'book' ? '.pdf' : 'audio/*'}">
                                    </label>
                                `}
                            `}
                        </div>
                        
                        <div class="form-section">
                            <label class="form-label">Screenshots (up to 5)</label>
                            <div class="ss-upload-wrap">
                                ${uploadData.screenshotPreviews.map((s, i) => `
                                    <div class="ss-preview">
                                        <img src="${s}" alt="Screenshot">
                                        <button type="button" class="ss-remove" onclick="removeScreenshot(${i})">${icons.x}</button>
                                    </div>
                                `).join('')}
                                ${uploadData.screenshotPreviews.length < 5 ? `
                                    <label class="ss-upload">
                                        ${icons.plus}<span style="font-size:12px;color:#6b7280;">Add</span>
                                        <input type="file" accept="image/*" style="display:none;" onchange="handleScreenshotSelect(this)">
                                    </label>
                                ` : ''}
                            </div>
                        </div>
                        
                        ${isLoading ? `
                            <div class="form-section">
                                <div class="progress-bar"><div class="progress-fill" style="width:${uploadProgress}%"></div></div>
                                <p class="upload-status">${uploadStatus}</p>
                            </div>
                        ` : ''}
                        
                        <button type="submit" class="download-btn" style="margin-bottom:24px;" ${isLoading ? 'disabled' : ''}>
                            ${isLoading ? '<div class="spinner" style="width:20px;height:20px;border-width:2px;"></div>' : icons.check}
                            ${isLoading ? 'Uploading...' : 'Publish'}
                        </button>
                    </form>
                </main>
                ${renderBottomNav()}
            `;
        }
        
        // ========== RENDER: PROFILE ==========
        function renderProfile() {
            if (!currentUser) {
                return `
                    <div class="auth-screen">
                        <div class="auth-card">
                            <div class="auth-icon">${icons.user}</div>
                            <h2 class="auth-title">Sign In</h2>
                            <p class="auth-desc">Sign in to view your profile.</p>
                            <button class="btn" style="width:100%;justify-content:center;padding:16px;" onclick="showLoginModal()">Sign In</button>
                            <a href__="#" class="auth-link" onclick="navigateTo('home');return false;">Go back home</a>
                        </div>
                    </div>
                    ${renderBottomNav()}
                `;
            }
            
            const myApps = apps.filter(a => a.authorEmail === currentUser.email);
            const totalDownloads = myApps.reduce((sum, a) => sum + (a.downloads || 0), 0);
            
            return `
                <header class="header">
                    <div class="header-content">
                        <div style="display:flex;align-items:center;gap:16px;">
                            <button onclick="navigateTo('home')" style="background:none;border:none;padding:8px;cursor:pointer;">${icons.back}</button>
                            <h1 style="font-weight:600;">My Profile</h1>
                        </div>
                    </div>
                </header>
                
                <main class="main" style="padding-top:24px;">
                    <div class="profile-card">
                        <div class="profile-header">
                            <div class="profile-avatar">${(currentUser.name || currentUser.email)[0].toUpperCase()}</div>
                            <div>
                                <h2 class="profile-name">${currentUser.name || 'User'}</h2>
                                <div class="profile-email">${icons.mail}<span>${currentUser.email}</span></div>
                            </div>
                        </div>
                        <div class="profile-stats">
                            <div class="profile-stat"><div class="profile-stat-val">${myApps.length}</div><div class="profile-stat-label">Uploads</div></div>
                            <div class="profile-stat"><div class="profile-stat-val">${formatNumber(totalDownloads)}</div><div class="profile-stat-label">Downloads</div></div>
                        </div>
                        <button class="btn btn-outline" style="width:100%;justify-content:center;" onclick="logout()">${icons.logout} Sign Out</button>
                    </div>
                    
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                        <h3 style="font-size:18px;font-weight:600;">My Uploads</h3>
                        <a href__="#" onclick="navigateTo('upload');return false;" style="color:#059669;font-weight:500;font-size:14px;">${icons.plus} Add New</a>
                    </div>
                    
                    ${myApps.length > 0 ? myApps.map(app => `
                        <div class="app-card" onclick="viewApp('${app.id}')">
                            <div class="app-icon-wrap">
                                <img src="${app.iconUrl || ''}" alt="${app.title}" class="app-icon">
                                <div class="app-badge">${getCategoryIcon(app.category)}</div>
                            </div>
                            <div class="app-info">
                                <div class="app-title">${app.title}</div>
                                <div class="app-stats"><span>${icons.download} ${formatNumber(app.downloads)}</span></div>
                            </div>
                        </div>
                    `).join('') : `
                        <div class="section" style="text-align:center;padding:40px;">
                            <div class="empty-icon" style="margin:0 auto 16px;">${icons.file}</div>
                            <h3>No uploads yet</h3>
                            <button class="btn" onclick="navigateTo('upload')" style="margin-top:16px;">${icons.plus} Upload Now</button>
                        </div>
                    `}
                </main>
                ${renderBottomNav()}
            `;
        }
        
        // ========== EVENT HANDLERS ==========
        function showLoginModal() {
            const modal = document.createElement('div');
            modal.id = 'loginModal';
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Sign In</h2>
                        <button class="modal-close" onclick="closeLoginModal()">${icons.x}</button>
                    </div>
                    <form onsubmit="handleLogin(event)">
                        <label class="form-label-sm">Full Name</label>
                        <input type="text" name="name" class="form-input" placeholder="John Doe" required>
                        <label class="form-label-sm">Email</label>
                        <input type="email" name="email" class="form-input" placeholder="john@example.com" required>
                        <button type="submit" class="btn" style="width:100%;justify-content:center;padding:14px;margin-top:8px;">Sign In</button>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function closeLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) modal.remove();
        }
        
        async function handleLogin(e) {
            e.preventDefault();
            const form = e.target;
            currentUser = { name: form.name.value, email: form.email.value, createdDate: new Date().toISOString() };
            await saveUserToFirestore(currentUser);
            closeLoginModal();
            render();
        }
        
        function logout() {
            currentUser = null;
            navigateTo('home');
        }
        
        function selectCategory(cat) {
            uploadData.category = cat;
            uploadData.downloadType = cat === 'app' ? 'apk' : cat === 'book' ? 'pdf' : 'audio';
            uploadData.appFile = null;
            uploadData.fileName = null;
            uploadData.fileSize = null;
            render();
        }
        
        function selectDownloadType(type) {
            uploadData.downloadType = type;
            uploadData.appFile = null;
            uploadData.fileName = null;
            uploadData.fileSize = null;
            render();
        }
        
        function handleIconSelect(input) {
            if (input.files && input.files[0]) {
                uploadData.iconFile = input.files[0];
                uploadData.iconPreview = URL.createObjectURL(input.files[0]);
                render();
            }
        }
        
        function removeIcon() {
            uploadData.iconFile = null;
            uploadData.iconPreview = null;
            render();
        }
        
        function handleFileSelect(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                uploadData.appFile = file;
                uploadData.fileName = file.name;
                uploadData.fileSize = (file.size / (1024 * 1024)).toFixed(2) + ' MB';
                render();
            }
        }
        
        function removeFile() {
            uploadData.appFile = null;
            uploadData.fileName = null;
            uploadData.fileSize = null;
            render();
        }
        
        function handleScreenshotSelect(input) {
            if (input.files && input.files[0]) {
                uploadData.screenshotFiles.push(input.files[0]);
                uploadData.screenshotPreviews.push(URL.createObjectURL(input.files[0]));
                render();
            }
        }
        
        function removeScreenshot(index) {
            uploadData.screenshotFiles.splice(index, 1);
            uploadData.screenshotPreviews.splice(index, 1);
            render();
        }
        
        async function handleUpload(e) {
            e.preventDefault();
            const form = e.target;
            
            if (!uploadData.iconFile) { alert('Please select an icon'); return; }
            if (uploadData.downloadType !== 'pwa' && !uploadData.appFile) { alert('Please select a file'); return; }
            
            isLoading = true;
            render();
            
            try {
                const timestamp = Date.now();
                
                // Upload icon
                uploadStatus = 'Uploading icon...';
                uploadProgress = 10;
                render();
                const iconUrl = await uploadFileToStorage(uploadData.iconFile, `beelze/icons/${timestamp}_${uploadData.iconFile.name}`);
                
                // Upload app file
                let downloadUrl = '';
                if (uploadData.downloadType === 'pwa') {
                    downloadUrl = form.pwaUrl.value;
                } else {
                    uploadStatus = 'Uploading file... (this may take a while for large files)';
                    uploadProgress = 30;
                    render();
                    downloadUrl = await uploadFileToStorage(uploadData.appFile, `beelze/files/${timestamp}_${uploadData.appFile.name}`);
                }
                
                // Upload screenshots
                const screenshotUrls = [];
                for (let i = 0; i < uploadData.screenshotFiles.length; i++) {
                    uploadStatus = `Uploading screenshot ${i + 1}...`;
                    uploadProgress = 60 + (i * 10);
                    render();
                    const url = await uploadFileToStorage(uploadData.screenshotFiles[i], `beelze/screenshots/${timestamp}_${i}_${uploadData.screenshotFiles[i].name}`);
                    screenshotUrls.push(url);
                }
                
                uploadStatus = 'Saving...';
                uploadProgress = 90;
                render();
                
                await saveAppToFirestore({
                    title: form.title.value,
                    shortDesc: form.shortDesc.value,
                    description: form.description.value,
                    category: uploadData.category,
                    downloadType: uploadData.downloadType,
                    downloadUrl: downloadUrl,
                    iconUrl: iconUrl,
                    screenshots: screenshotUrls,
                    version: form.version.value || '1.0',
                    size: uploadData.fileSize || '',
                    tags: form.tags.value.split(',').map(t => t.trim()).filter(Boolean),
                    author: currentUser.name,
                    authorEmail: currentUser.email,
                    downloads: 0,
                    createdDate: new Date().toISOString()
                });
                
                await loadAppsFromFirestore();
                resetUploadData();
                isLoading = false;
                navigateTo('home');
                
            } catch (error) {
                console.error('Upload error:', error);
                alert('Upload failed: ' + error.message);
                isLoading = false;
                render();
            }
        }
        
        function shareApp() {
            const app = apps.find(a => a.id === selectedAppId);
            if (app && navigator.share) {
                navigator.share({ title: app.title, text: app.shortDesc, url: window.location.href });
            }
        }
        
        // ========== MAIN ==========
        function render() {
            let html = '';
            switch (currentPage) {
                case 'detail': html = renderDetail(); break;
                case 'upload': html = renderUpload(); break;
                case 'profile': html = renderProfile(); break;
                default: html = renderHome();
            }
            document.getElementById('app').innerHTML = html;
        }
        
        window.addEventListener('load', async () => {
            await loadAppsFromFirestore();
        });
    </script>
</body>
</html>
        });
    </script>
</body>
</html>
