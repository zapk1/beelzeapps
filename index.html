<!DOCTYPE html>
<html lang="en">
<head>



<link rel="manifest" href="manifest.json">
     <meta name="theme-color" content="#2196f3">

    <link rel="icon" href="https://i.postimg.cc/gJhjVfvM/Logo-for-Dark-Master-Store.png" type="image/png">
     <link rel="stylesheet" href="style.css">



    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beelze Apps - Alternative App Store</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f9fafb; color: #111827; min-height: 100vh; }
        
        .header { background: white; padding: 16px; border-bottom: 1px solid #e5e7eb; position: sticky; top: 0; z-index: 50; }
        .header-content { max-width: 768px; margin: 0 auto; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .logo { font-size: 24px; font-weight: bold; background: linear-gradient(to right, #059669, #0d9488); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .logo-sub { font-size: 12px; color: #6b7280; }
        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 16px; background: #059669; color: white; border: none; border-radius: 12px; font-weight: 500; cursor: pointer; font-size: 14px; }
        .btn:hover { background: #047857; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-outline { background: white; color: #374151; border: 1px solid #e5e7eb; }
        .btn-outline:hover { background: #f9fafb; }
        
        .search-box { position: relative; }
        .search-box svg { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; color: #9ca3af; }
        .search-input { width: 100%; padding: 14px 16px 14px 48px; background: #f3f4f6; border: none; border-radius: 16px; font-size: 16px; outline: none; }
        .search-input:focus { background: white; box-shadow: 0 0 0 2px #059669; }
        
        .categories { display: flex; gap: 8px; padding: 16px; max-width: 768px; margin: 0 auto; overflow-x: auto; }
        .cat-btn { display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: #f3f4f6; border: none; border-radius: 50px; font-weight: 500; font-size: 14px; color: #4b5563; cursor: pointer; white-space: nowrap; }
        .cat-btn.active { background: #059669; color: white; box-shadow: 0 4px 12px rgba(5,150,105,0.3); }
        .cat-btn svg { width: 16px; height: 16px; }
        
        .main { max-width: 768px; margin: 0 auto; padding: 0 16px 100px; }
        
        .featured { background: linear-gradient(135deg, #059669, #0d9488); border-radius: 24px; padding: 24px; color: white; margin-bottom: 24px; box-shadow: 0 10px 40px rgba(5,150,105,0.3); cursor: pointer; }
        .featured-content { display: flex; gap: 20px; }
        .featured-icon { width: 96px; height: 96px; border-radius: 20px; object-fit: cover; box-shadow: 0 10px 30px rgba(0,0,0,0.2); background: rgba(255,255,255,0.2); }
        .featured-badge { display: inline-block; padding: 4px 12px; background: rgba(255,255,255,0.2); border-radius: 50px; font-size: 12px; margin-bottom: 8px; }
        .featured-title { font-size: 20px; font-weight: bold; margin-bottom: 4px; }
        .featured-desc { color: rgba(255,255,255,0.8); font-size: 14px; margin-bottom: 12px; }
        .featured-stats { display: flex; align-items: center; gap: 16px; font-size: 14px; }
        
        .app-card { background: white; border-radius: 16px; padding: 16px; margin-bottom: 12px; border: 1px solid #e5e7eb; display: flex; gap: 16px; cursor: pointer; transition: all 0.2s; }
        .app-card:hover { box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-color: #a7f3d0; transform: translateY(-2px); }
        .app-icon-wrap { position: relative; flex-shrink: 0; }
        .app-icon { width: 80px; height: 80px; border-radius: 16px; object-fit: cover; box-shadow: 0 4px 12px rgba(0,0,0,0.1); background: linear-gradient(135deg, #e5e7eb, #d1d5db); }
        .app-badge { position: absolute; bottom: -4px; right: -4px; padding: 6px; background: #d1fae5; border-radius: 8px; }
        .app-badge svg { width: 12px; height: 12px; color: #059669; }
        .app-info { flex: 1; min-width: 0; }
        .app-title { font-weight: 600; color: #111827; margin-bottom: 2px; }
        .app-author { font-size: 14px; color: #6b7280; margin-bottom: 4px; }
        .app-desc { font-size: 12px; color: #9ca3af; margin-bottom: 8px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .app-stats { display: flex; align-items: center; gap: 12px; font-size: 12px; color: #6b7280; }
        .app-stats svg { width: 12px; height: 12px; }
        
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #e5e7eb; padding: 8px 0 env(safe-area-inset-bottom); z-index: 50; }
        .nav-content { max-width: 768px; margin: 0 auto; display: flex; justify-content: space-around; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px 24px; color: #6b7280; text-decoration: none; font-size: 12px; font-weight: 500; cursor: pointer; border: none; background: none; }
        .nav-item.active { color: #059669; }
        .nav-item svg { width: 24px; height: 24px; }
        .nav-avatar { width: 24px; height: 24px; background: linear-gradient(135deg, #34d399, #14b8a6); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; font-weight: bold; }
        
        .empty { text-align: center; padding: 60px 20px; }
        .empty-icon { width: 80px; height: 80px; background: #f3f4f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; }
        .empty-icon svg { width: 32px; height: 32px; color: #9ca3af; }
        .empty h3 { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
        .empty p { color: #6b7280; margin-bottom: 24px; }
        
        .detail-card { background: white; border-radius: 24px; padding: 24px; margin-bottom: 24px; border: 1px solid #e5e7eb; }
        .detail-top { display: flex; gap: 20px; margin-bottom: 24px; }
        .detail-icon { width: 112px; height: 112px; border-radius: 24px; object-fit: cover; box-shadow: 0 10px 30px rgba(0,0,0,0.15); background: linear-gradient(135deg, #e5e7eb, #d1d5db); }
        .detail-title { font-size: 24px; font-weight: bold; margin-bottom: 4px; }
        .detail-author { color: #059669; font-weight: 500; margin-bottom: 8px; }
        .detail-cat { display: inline-flex; align-items: center; gap: 4px; padding: 4px 12px; background: #d1fae5; color: #059669; border-radius: 50px; font-size: 12px; font-weight: 500; }
        .detail-cat svg { width: 12px; height: 12px; }
        .detail-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; padding: 24px 0; border-top: 1px solid #e5e7eb; border-bottom: 1px solid #e5e7eb; margin: 24px 0; }
        .stat { text-align: center; }
        .stat-val { font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 4px; }
        .stat-val svg { width: 16px; height: 16px; }
        .stat-label { font-size: 12px; color: #6b7280; margin-top: 4px; }
        .download-btn { width: 100%; padding: 18px; background: #059669; color: white; border: none; border-radius: 16px; font-size: 18px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 10px 30px rgba(5,150,105,0.3); }
        .download-btn:hover { background: #047857; }
        .download-btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .download-btn svg { width: 20px; height: 20px; }
        
        .screenshots { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 8px; margin-bottom: 24px; }
        .screenshot { width: 180px; height: auto; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); flex-shrink: 0; background: #f3f4f6; }
        
        .section { background: white; border-radius: 24px; padding: 24px; margin-bottom: 24px; border: 1px solid #e5e7eb; }
        .section-title { font-size: 18px; font-weight: 600; margin-bottom: 12px; }
        .section-text { color: #4b5563; line-height: 1.6; white-space: pre-wrap; }
        
        .dev-info { display: flex; align-items: center; gap: 12px; }
        .dev-avatar { width: 40px; height: 40px; background: #d1fae5; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .dev-avatar svg { width: 20px; height: 20px; color: #059669; }
        .dev-name { font-weight: 500; }
        .dev-email { font-size: 14px; color: #6b7280; }
        
        .form-section { background: white; border-radius: 16px; padding: 24px; margin-bottom: 16px; border: 1px solid #e5e7eb; }
        .form-label { display: block; font-weight: 600; margin-bottom: 12px; font-size: 16px; }
        .form-label-sm { font-weight: normal; font-size: 14px; color: #374151; margin-bottom: 8px; display: block; }
        .form-input { width: 100%; padding: 12px 16px; border: 1px solid #e5e7eb; border-radius: 12px; font-size: 16px; outline: none; margin-bottom: 16px; }
        .form-input:focus { border-color: #059669; box-shadow: 0 0 0 2px rgba(5,150,105,0.2); }
        .form-textarea { width: 100%; padding: 12px 16px; border: 1px solid #e5e7eb; border-radius: 12px; font-size: 16px; min-height: 120px; resize: vertical; outline: none; font-family: inherit; }
        .form-textarea:focus { border-color: #059669; box-shadow: 0 0 0 2px rgba(5,150,105,0.2); }
        .form-select { width: 100%; padding: 12px 16px; border: 1px solid #e5e7eb; border-radius: 12px; font-size: 16px; outline: none; margin-bottom: 16px; background: white; }
        
        .cat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .cat-option { padding: 16px; border: 2px solid #e5e7eb; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .cat-option:hover { border-color: #a7f3d0; }
        .cat-option.selected { border-color: #059669; background: #ecfdf5; }
        .cat-option svg { width: 24px; height: 24px; margin: 0 auto 8px; color: #9ca3af; display: block; }
        .cat-option.selected svg { color: #059669; }
        .cat-option span { font-size: 14px; font-weight: 500; color: #4b5563; }
        .cat-option.selected span { color: #059669; }
        
        .file-upload { padding: 32px; border: 2px dashed #d1d5db; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .file-upload:hover { border-color: #059669; }
        .file-upload svg { width: 32px; height: 32px; color: #9ca3af; margin-bottom: 8px; }
        .file-upload p { font-size: 14px; color: #6b7280; }
        
        .icon-upload-wrap { display: flex; align-items: center; gap: 16px; }
        .icon-upload { width: 96px; height: 96px; border: 2px dashed #d1d5db; border-radius: 16px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
        .icon-upload:hover { border-color: #059669; }
        .icon-upload svg { width: 24px; height: 24px; color: #9ca3af; margin-bottom: 4px; }
        .icon-upload span { font-size: 12px; color: #6b7280; }
        .icon-preview { width: 96px; height: 96px; border-radius: 16px; object-fit: cover; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .icon-tips { font-size: 14px; color: #6b7280; }
        .icon-tips p { margin-bottom: 4px; }
        
        .ss-upload-wrap { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 8px; }
        .ss-upload { width: 120px; height: 200px; border: 2px dashed #d1d5db; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0; }
        .ss-upload:hover { border-color: #059669; }
        .ss-preview { width: 120px; height: 200px; border-radius: 12px; flex-shrink: 0; position: relative; }
        .ss-preview img { width: 100%; height: 100%; object-fit: cover; border-radius: 12px; }
        .ss-remove { position: absolute; top: -8px; right: -8px; width: 24px; height: 24px; background: #ef4444; color: white; border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .ss-remove svg { width: 14px; height: 14px; }
        
        .profile-card { background: white; border-radius: 24px; padding: 24px; margin-bottom: 24px; border: 1px solid #e5e7eb; }
        .profile-header { display: flex; align-items: center; gap: 16px; margin-bottom: 24px; }
        .profile-avatar { width: 80px; height: 80px; background: linear-gradient(135deg, #34d399, #14b8a6); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 28px; font-weight: bold; box-shadow: 0 10px 30px rgba(5,150,105,0.3); }
        .profile-name { font-size: 20px; font-weight: bold; }
        .profile-email { display: flex; align-items: center; gap: 8px; color: #6b7280; margin-top: 4px; font-size: 14px; }
        .profile-email svg { width: 16px; height: 16px; }
        .profile-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 24px; }
        .profile-stat { background: #f9fafb; border-radius: 12px; padding: 16px; text-align: center; }
        .profile-stat-val { font-size: 24px; font-weight: bold; }
        .profile-stat-label { font-size: 14px; color: #6b7280; }
        
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 100; padding: 16px; }
        .modal-content { background: white; border-radius: 24px; padding: 32px; max-width: 400px; width: 100%; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .modal-header h2 { font-size: 20px; font-weight: bold; }
        .modal-close { background: none; border: none; cursor: pointer; padding: 8px; }
        .modal-close svg { width: 24px; height: 24px; }
        
        .auth-screen { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 16px; }
        .auth-card { background: white; border-radius: 24px; padding: 32px; max-width: 400px; width: 100%; text-align: center; border: 1px solid #e5e7eb; }
        .auth-icon { width: 64px; height: 64px; background: #d1fae5; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; }
        .auth-icon svg { width: 32px; height: 32px; color: #059669; }
        .auth-title { font-size: 20px; font-weight: bold; margin-bottom: 8px; }
        .auth-desc { color: #6b7280; margin-bottom: 24px; }
        .auth-link { display: block; margin-top: 16px; color: #059669; text-decoration: none; }
        
        .file-selected { display: flex; align-items: center; gap: 12px; padding: 16px; background: #ecfdf5; border-radius: 12px; }
        .file-selected svg { width: 32px; height: 32px; color: #059669; }
        .file-selected-info { flex: 1; min-width: 0; }
        .file-selected-name { font-weight: 500; color: #111827; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .file-selected-size { font-size: 14px; color: #6b7280; }
        .file-selected-remove { padding: 8px; background: none; border: none; cursor: pointer; color: #6b7280; }
        .file-selected-remove:hover { color: #ef4444; }
        
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .result-count { color: #6b7280; font-size: 14px; margin-bottom: 16px; }
        
        .progress-bar { width: 100%; height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden; margin-top: 12px; }
        .progress-fill { height: 100%; background: #059669; transition: width 0.3s; }
        .upload-status { text-align: center; margin-top: 8px; font-size: 14px; color: #6b7280; }
        
        .downloading { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 200; }
        .downloading-content { background: white; border-radius: 24px; padding: 32px; text-align: center; max-width: 300px; }
        .downloading-content h3 { margin: 16px 0 8px; font-size: 18px; }
        .downloading-content p { color: #6b7280; font-size: 14px; }
        .spinner { width: 50px; height: 50px; border: 4px solid #e5e7eb; border-top-color: #059669; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .placeholder-icon { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #e5e7eb, #d1d5db); border-radius: inherit; font-size: 32px; font-weight: bold; color: #9ca3af; }
    </style>
</head>
<body>
    <div id="app"></div>
    <div id="downloadModal"></div>
    
    <script>
        // ========== FIREBASE REALTIME DATABASE ==========
        const FIREBASE_DB_URL = 'https://streamx-a4099-default-rtdb.firebaseio.com';
        
        // ========== ICONS ==========
        const icons = {
            search: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>`,
            plus: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>`,
            home: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>`,
            upload: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>`,
            user: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>`,
            download: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>`,
            phone: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>`,
            book: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>`,
            music: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/></svg>`,
            grid: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/></svg>`,
            back: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>`,
            share: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>`,
            logout: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>`,
            mail: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>`,
            x: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>`,
            check: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>`,
            image: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>`,
            file: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>`,
            external: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>`
        };
        
        // ========== DEFAULT APPS (with working placeholder icons) ==========
        const defaultApps = [
            { id: 'default_1', title: 'WhatsApp Mod', shortDesc: 'Enhanced WhatsApp with extra features', description: 'WhatsApp Mod with anti-delete messages, hide online status, download status, and many more features.', category: 'app', downloadType: 'apk', downloadUrl: '', iconUrl: 'https://cdn-icons-png.flaticon.com/512/733/733585.png', author: 'ModDev Team', downloads: 15420, size: '45 MB', version: '2.24.1', isDefault: true },
            { id: 'default_2', title: 'Spotify Premium', shortDesc: 'Unlock all Spotify features', description: 'Spotify with premium features unlocked. Ad-free music, unlimited skips, and offline downloads.', category: 'app', downloadType: 'apk', downloadUrl: '', iconUrl: 'https://cdn-icons-png.flaticon.com/512/2111/2111624.png', author: 'Premium Mods', downloads: 28930, size: '32 MB', version: '8.9.0', isDefault: true },
            { id: 'default_3', title: 'Instagram Pro', shortDesc: 'Instagram with download features', description: 'Download photos, videos, stories, and reels directly.', category: 'app', downloadType: 'apk', downloadUrl: '', iconUrl: 'https://cdn-icons-png.flaticon.com/512/2111/2111463.png', author: 'InstaTeam', downloads: 42100, size: '58 MB', version: '4.2.0', isDefault: true },
            { id: 'default_4', title: 'YouTube Vanced', shortDesc: 'Ad-free YouTube experience', description: 'YouTube without ads, background playback, and SponsorBlock.', category: 'app', downloadType: 'apk', downloadUrl: '', iconUrl: 'https://cdn-icons-png.flaticon.com/512/1384/1384060.png', author: 'Vanced Team', downloads: 89200, size: '78 MB', version: '18.45.1', isDefault: true },
            { id: 'default_5', title: 'Rich Dad Poor Dad', shortDesc: 'Financial education bestseller', description: 'What the Rich Teach Their Kids About Money.', category: 'book', downloadType: 'pdf', downloadUrl: '', iconUrl: 'https://cdn-icons-png.flaticon.com/512/2232/2232688.png', author: 'Robert Kiyosaki', downloads: 12500, size: '2.4 MB', version: '1.0', isDefault: true },
            { id: 'default_6', title: 'The 48 Laws of Power', shortDesc: 'Master the game of power', description: 'A modern classic on power and strategy by Robert Greene.', category: 'book', downloadType: 'pdf', downloadUrl: '', iconUrl: 'https://cdn-icons-png.flaticon.com/512/3330/3330314.png', author: 'Robert Greene', downloads: 18700, size: '3.1 MB', version: '1.0', isDefault: true },
            { id: 'default_7', title: 'Think and Grow Rich', shortDesc: 'The classic wealth guide', description: 'Napoleon Hill\'s masterpiece on achieving success.', category: 'book', downloadType: 'pdf', downloadUrl: '', iconUrl: 'https://cdn-icons-png.flaticon.com/512/2702/2702154.png', author: 'Napoleon Hill', downloads: 9800, size: '1.8 MB', version: '1.0', isDefault: true },
            { id: 'default_8', title: 'Chill Lofi Beats', shortDesc: 'Relaxing study music', description: 'Perfect lofi hip-hop beats for studying or relaxing.', category: 'music', downloadType: 'audio', downloadUrl: '', iconUrl: 'https://cdn-icons-png.flaticon.com/512/3844/3844724.png', author: 'ChillBeats', downloads: 5600, size: '45 MB', version: '1.0', isDefault: true },
            { id: 'default_9', title: 'Motivational Speeches', shortDesc: 'Get inspired daily', description: 'Compilation of the best motivational speeches.', category: 'music', downloadType: 'audio', downloadUrl: '', iconUrl: 'https://cdn-icons-png.flaticon.com/512/2936/2936690.png', author: 'MotivateMe', downloads: 3200, size: '28 MB', version: '1.0', isDefault: true },
            { id: 'default_10', title: 'TikTok No Watermark', shortDesc: 'Download without watermarks', description: 'Save TikTok videos without the watermark.', category: 'app', downloadType: 'apk', downloadUrl: '', iconUrl: 'https://cdn-icons-png.flaticon.com/512/3046/3046121.png', author: 'TikMod', downloads: 67800, size: '92 MB', version: '32.1.5', isDefault: true }
        ];
        
        // ========== STATE ==========
        let dbApps = [];
        let currentUser = null;
        let currentPage = 'home';
        let currentCategory = 'all';
        let searchQuery = '';
        let selectedAppId = null;
        let isUploading = false;
        let uploadProgress = 0;
        let uploadStatus = '';
        
        // Upload state
        let uploadFormData = { title: '', shortDesc: '', description: '', version: '1.0', tags: '', pwaUrl: '' };
        let uploadCategory = 'app';
        let uploadDownloadType = 'apk';
        let uploadIconPreview = null;
        let uploadIconBase64 = null;
        let uploadFileName = null;
        let uploadFileSize = null;
        let uploadFileBase64 = null;
        let uploadScreenshots = [];
        
        function getAllApps() {
            const all = [...defaultApps, ...dbApps];
            return all.sort((a, b) => (b.downloads || 0) - (a.downloads || 0));
        }
        
        // ========== FIREBASE FUNCTIONS ==========
        async function loadAppsFromDB() {
            try {
                const response = await fetch(`${FIREBASE_DB_URL}/beelzeApps.json`);
                if (!response.ok) {
                    console.log('Firebase returned error, using defaults only');
                    dbApps = [];
                    render();
                    return;
                }
                const data = await response.json();
                if (data && typeof data === 'object') {
                    dbApps = Object.keys(data).map(key => ({ id: key, ...data[key] }));
                } else {
                    dbApps = [];
                }
                render();
            } catch (e) {
                console.error('Error loading from DB:', e);
                dbApps = [];
                render();
            }
        }
        
        async function saveAppToDB(appData) {
            const response = await fetch(`${FIREBASE_DB_URL}/beelzeApps.json`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(appData)
            });
            if (!response.ok) throw new Error('Failed to save to database');
            return (await response.json()).name;
        }
        
        async function updateAppInDB(appId, data) {
            await fetch(`${FIREBASE_DB_URL}/beelzeApps/${appId}.json`, {
                method: 'PATCH',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
        }
        
        async function saveUserToDB(userData) {
            const safeEmail = userData.email.replace(/\./g, '_');
            await fetch(`${FIREBASE_DB_URL}/beelzeUsers/${safeEmail}.json`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(userData)
            });
        }
        
        // ========== UTILITIES ==========
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return (num || 0).toString();
        }
        
        function getCategoryIcon(cat) {
            if (cat === 'app') return icons.phone;
            if (cat === 'book') return icons.book;
            if (cat === 'music') return icons.music;
            return icons.grid;
        }
        
        function getCategoryLabel(cat) {
            if (cat === 'app') return 'Application';
            if (cat === 'book') return 'Book / PDF';
            if (cat === 'music') return 'Music / Audio';
            return 'All';
        }
        
        function getDownloadTypeLabel(type) {
            if (type === 'apk') return 'APK File';
            if (type === 'pwa') return 'Web App (PWA)';
            if (type === 'pdf') return 'PDF Document';
            if (type === 'audio') return 'Audio File';
            return 'File';
        }
        
        function getMimeType(type) {
            if (type === 'apk') return 'application/vnd.android.package-archive';
            if (type === 'pdf') return 'application/pdf';
            if (type === 'audio') return 'audio/mpeg';
            return 'application/octet-stream';
        }
        
        function getFileExtension(type) {
            if (type === 'apk') return '.apk';
            if (type === 'pdf') return '.pdf';
            if (type === 'audio') return '.mp3';
            return '';
        }
        
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        function compressImage(dataUrl, maxWidth = 300, quality = 0.7) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    let width = img.width, height = img.height;
                    if (width > maxWidth) { height = (height * maxWidth) / width; width = maxWidth; }
                    canvas.width = width; canvas.height = height;
                    canvas.getContext('2d').drawImage(img, 0, 0, width, height);
                    resolve(canvas.toDataURL('image/jpeg', quality));
                };
                img.src = dataUrl;
            });
        }
        
        function getInitials(title) {
            return (title || 'A').charAt(0).toUpperCase();
        }
        
        // ========== RENDER ICON (with fallback) ==========
        function renderAppIcon(app, size = 80, rounded = 16) {
            const initials = getInitials(app.title);
            const colors = ['#ef4444', '#f97316', '#eab308', '#22c55e', '#06b6d4', '#3b82f6', '#8b5cf6', '#ec4899'];
            const colorIndex = (app.title || '').charCodeAt(0) % colors.length;
            const bgColor = colors[colorIndex];
            
            if (app.iconUrl) {
                return `<img src="${app.iconUrl}" alt="${app.title}" style="width:${size}px;height:${size}px;border-radius:${rounded}px;object-fit:cover;" onerror="this.outerHTML='<div style=\\'width:${size}px;height:${size}px;border-radius:${rounded}px;background:${bgColor};display:flex;align-items:center;justify-content:center;color:white;font-size:${size/2.5}px;font-weight:bold;\\'>${initials}</div>'">`;
            }
            return `<div style="width:${size}px;height:${size}px;border-radius:${rounded}px;background:${bgColor};display:flex;align-items:center;justify-content:center;color:white;font-size:${size/2.5}px;font-weight:bold;">${initials}</div>`;
        }
        
        // ========== DOWNLOAD ==========
        async function downloadApp(id) {
            const allApps = getAllApps();
            const app = allApps.find(a => a.id === id);
            if (!app) return;
            
            // Update count for DB apps
            if (!app.isDefault && app.id) {
                const newCount = (app.downloads || 0) + 1;
                try {
                    await updateAppInDB(app.id, { downloads: newCount });
                    const dbApp = dbApps.find(a => a.id === app.id);
                    if (dbApp) dbApp.downloads = newCount;
                    render();
                } catch (e) { console.error(e); }
            }
            
            // PWA
            if (app.downloadType === 'pwa' && app.downloadUrl) {
                window.open(app.downloadUrl, '_blank');
                return;
            }
            
            // Default demo apps
            if (app.isDefault) {
                alert('This is a demo app. Upload your own apps to enable real downloads!');
                return;
            }
            
            // Real file download
            if (app.fileBase64) {
                showDownloadModal(app.title);
                try {
                    const base64Data = app.fileBase64.split(',')[1];
                    const binaryString = atob(base64Data);
                    const bytes = new Uint8Array(binaryString.length);
                    for (let i = 0; i < binaryString.length; i++) {
                        bytes[i] = binaryString.charCodeAt(i);
                    }
                    const blob = new Blob([bytes], { type: getMimeType(app.downloadType) });
                    const url = URL.createObjectURL(blob);
                    const filename = (app.title || 'download').replace(/[^a-z0-9]/gi, '_') + getFileExtension(app.downloadType);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    setTimeout(() => { document.body.removeChild(a); URL.revokeObjectURL(url); hideDownloadModal(); }, 1000);
                } catch (error) {
                    console.error('Download error:', error);
                    hideDownloadModal();
                    alert('Download failed. Please try again.');
                }
            } else {
                alert('No file available for download.');
            }
        }
        
        function showDownloadModal(title) {
            document.getElementById('downloadModal').innerHTML = `<div class="downloading"><div class="downloading-content"><div class="spinner"></div><h3>Downloading...</h3><p>${title}</p></div></div>`;
        }
        
        function hideDownloadModal() {
            document.getElementById('downloadModal').innerHTML = '';
        }
        
        // ========== NAVIGATION ==========
        function navigateTo(page) {
            currentPage = page;
            if (page === 'upload') resetUploadData();
            render();
            window.scrollTo(0, 0);
        }
        
        function setCategory(cat) { currentCategory = cat; render(); }
        
        function handleSearch(value) { 
            searchQuery = value || ''; 
            render(); 
        }
        
        function viewApp(id) { selectedAppId = id; currentPage = 'detail'; render(); window.scrollTo(0, 0); }
        
        // ========== RENDER: BOTTOM NAV ==========
        function renderBottomNav() {
            return `<nav class="bottom-nav"><div class="nav-content">
                <button class="nav-item ${currentPage === 'home' || currentPage === 'detail' ? 'active' : ''}" onclick="navigateTo('home')">${icons.home}<span>Home</span></button>
                <button class="nav-item ${currentPage === 'upload' ? 'active' : ''}" onclick="navigateTo('upload')">${icons.upload}<span>Upload</span></button>
                <button class="nav-item ${currentPage === 'profile' ? 'active' : ''}" onclick="navigateTo('profile')">${currentUser ? `<div class="nav-avatar">${(currentUser.name || currentUser.email || 'U')[0].toUpperCase()}</div>` : icons.user}<span>Profile</span></button>
            </div></nav>`;
        }
        
        // ========== RENDER: HOME ==========
        function renderHome() {
            const allApps = getAllApps();
            const query = (searchQuery || '').toLowerCase().trim();
            
            const filtered = allApps.filter(app => {
                if (!app) return false;
                const matchesCat = currentCategory === 'all' || app.category === currentCategory;
                if (!query) return matchesCat;
                const title = (app.title || '').toLowerCase();
                const desc = (app.description || '').toLowerCase();
                const shortDesc = (app.shortDesc || '').toLowerCase();
                const matchesSearch = title.includes(query) || desc.includes(query) || shortDesc.includes(query);
                return matchesCat && matchesSearch;
            });
            
            const featured = allApps[0];
            
            return `
                <header class="header"><div class="header-content">
                    <div class="header-top">
                        <div><div class="logo">Beelze Apps</div><div class="logo-sub">Your alternative app store</div></div>
                        <button class="btn" onclick="navigateTo('upload')">${icons.plus}<span>Upload</span></button>
                    </div>
                    <div class="search-box">${icons.search}<input type="text" class="search-input" placeholder="Search apps, books, music..." value="${searchQuery}" oninput="handleSearch(this.value)"></div>
                </div></header>
                
                <div class="categories">
                    <button class="cat-btn ${currentCategory === 'all' ? 'active' : ''}" onclick="setCategory('all')">${icons.grid} All</button>
                    <button class="cat-btn ${currentCategory === 'app' ? 'active' : ''}" onclick="setCategory('app')">${icons.phone} Apps</button>
                    <button class="cat-btn ${currentCategory === 'book' ? 'active' : ''}" onclick="setCategory('book')">${icons.book} Books</button>
                    <button class="cat-btn ${currentCategory === 'music' ? 'active' : ''}" onclick="setCategory('music')">${icons.music} Music</button>
                </div>
                
                <main class="main">
                    ${!query && currentCategory === 'all' && featured ? `
                        <div class="featured" onclick="viewApp('${featured.id}')">
                            <div class="featured-content">
                                ${renderAppIcon(featured, 96, 20)}
                                <div style="flex:1;min-width:0;">
                                    <span class="featured-badge">Featured</span>
                                    <h2 class="featured-title">${featured.title || 'Untitled'}</h2>
                                    <p class="featured-desc">${featured.shortDesc || ''}</p>
                                    <div class="featured-stats"><span style="display:flex;align-items:center;gap:4px;">${icons.download} ${formatNumber(featured.downloads)} downloads</span></div>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    ${query ? `<p class="result-count">${filtered.length} results for "${query}"</p>` : ''}
                    
                    ${filtered.length > 0 ? filtered.map(app => `
                        <div class="app-card" onclick="viewApp('${app.id}')">
                            <div class="app-icon-wrap">
                                ${renderAppIcon(app, 80, 16)}
                                <div class="app-badge">${getCategoryIcon(app.category)}</div>
                            </div>
                            <div class="app-info">
                                <div class="app-title">${app.title || 'Untitled'}</div>
                                <div class="app-author">${app.author || 'Unknown'}</div>
                                <div class="app-desc">${app.shortDesc || ''}</div>
                                <div class="app-stats">
                                    <span style="display:flex;align-items:center;gap:4px;">${icons.download} ${formatNumber(app.downloads)}</span>
                                    ${app.size ? `<span>${app.size}</span>` : ''}
                                </div>
                            </div>
                        </div>
                    `).join('') : `
                        <div class="empty">
                            <div class="empty-icon">${icons.search}</div>
                            <h3>No results found</h3>
                            <p>Try a different search term</p>
                        </div>
                    `}
                </main>
                ${renderBottomNav()}
            `;
        }
        
        // ========== RENDER: DETAIL ==========
        function renderDetail() {
            const allApps = getAllApps();
            const app = allApps.find(a => a.id === selectedAppId);
            if (!app) return renderHome();
            
            return `
                <header class="header"><div class="header-content">
                    <div style="display:flex;align-items:center;gap:16px;">
                        <button onclick="navigateTo('home')" style="background:none;border:none;padding:8px;cursor:pointer;">${icons.back}</button>
                        <h1 style="font-weight:600;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${app.title || 'Untitled'}</h1>
                        <button onclick="shareApp()" style="background:none;border:none;padding:8px;cursor:pointer;">${icons.share}</button>
                    </div>
                </div></header>
                
                <main class="main" style="padding-top:24px;">
                    <div class="detail-card">
                        <div class="detail-top">
                            ${renderAppIcon(app, 112, 24)}
                            <div style="flex:1;min-width:0;">
                                <h2 class="detail-title">${app.title || 'Untitled'}</h2>
                                <p class="detail-author">${app.author || 'Unknown'}</p>
                                <span class="detail-cat">${getCategoryIcon(app.category)} ${getCategoryLabel(app.category)}</span>
                            </div>
                        </div>
                        <div class="detail-stats">
                            <div class="stat"><div class="stat-val">${icons.download} ${formatNumber(app.downloads)}</div><div class="stat-label">Downloads</div></div>
                            <div class="stat"><div class="stat-val">${app.size || 'N/A'}</div><div class="stat-label">Size</div></div>
                            <div class="stat"><div class="stat-val">${app.version || '1.0'}</div><div class="stat-label">Version</div></div>
                        </div>
                        <button class="download-btn" onclick="downloadApp('${app.id}')">
                            ${app.downloadType === 'pwa' ? icons.external : icons.download}
                            ${app.downloadType === 'pwa' ? 'Open App' : 'Download'}
                        </button>
                        <p style="text-align:center;font-size:12px;color:#6b7280;margin-top:12px;">${getDownloadTypeLabel(app.downloadType)}</p>
                    </div>
                    
                    ${app.screenshots && app.screenshots.length > 0 ? `
                        <div style="margin-bottom:24px;">
                            <h3 class="section-title">Screenshots</h3>
                            <div class="screenshots">${app.screenshots.map(s => `<img src="${s}" class="screenshot" alt="Screenshot" onerror="this.style.display='none'">`).join('')}</div>
                        </div>
                    ` : ''}
                    
                    <div class="section">
                        <h3 class="section-title">About</h3>
                        <p class="section-text">${app.description || 'No description available.'}</p>
                    </div>
                    
                    <div class="section">
                        <h3 class="section-title">Developer</h3>
                        <div class="dev-info">
                            <div class="dev-avatar">${icons.user}</div>
                            <div><p class="dev-name">${app.author || 'Unknown'}</p><p class="dev-email">${app.authorEmail || ''}</p></div>
                        </div>
                    </div>
                </main>
                ${renderBottomNav()}
            `;
        }
        
        // ========== RENDER: UPLOAD ==========
        function resetUploadData() {
            uploadFormData = { title: '', shortDesc: '', description: '', version: '1.0', tags: '', pwaUrl: '' };
            uploadCategory = 'app'; uploadDownloadType = 'apk';
            uploadIconPreview = null; uploadIconBase64 = null;
            uploadFileName = null; uploadFileSize = null; uploadFileBase64 = null;
            uploadScreenshots = []; uploadProgress = 0; uploadStatus = ''; isUploading = false;
        }
        
        function renderUpload() {
            if (!currentUser) {
                return `<div class="auth-screen"><div class="auth-card">
                    <div class="auth-icon">${icons.upload}</div>
                    <h2 class="auth-title">Sign in to Upload</h2>
                    <p class="auth-desc">You need to be signed in to upload.</p>
                    <button class="btn" style="width:100%;justify-content:center;padding:16px;" onclick="showLoginModal()">Sign In</button>
                    <a href__="#" class="auth-link" onclick="navigateTo('home');return false;">Go back home</a>
                </div></div>${renderBottomNav()}`;
            }
            
            const downloadTypes = { app: [{ value: 'apk', label: 'APK File' }, { value: 'pwa', label: 'Web App (PWA URL)' }], book: [{ value: 'pdf', label: 'PDF Document' }], music: [{ value: 'audio', label: 'Audio File' }] };
            
            return `
                <header class="header"><div class="header-content"><div style="display:flex;align-items:center;gap:16px;">
                    <button onclick="navigateTo('home')" style="background:none;border:none;padding:8px;cursor:pointer;">${icons.back}</button>
                    <h1 style="font-weight:600;">Upload New Item</h1>
                </div></div></header>
                
                <main class="main" style="padding-top:24px;">
                    <div class="form-section">
                        <label class="form-label">Category</label>
                        <div class="cat-grid">
                            <div class="cat-option ${uploadCategory === 'app' ? 'selected' : ''}" onclick="selectUploadCategory('app')">${icons.phone}<span>App</span></div>
                            <div class="cat-option ${uploadCategory === 'book' ? 'selected' : ''}" onclick="selectUploadCategory('book')">${icons.book}<span>Book</span></div>
                            <div class="cat-option ${uploadCategory === 'music' ? 'selected' : ''}" onclick="selectUploadCategory('music')">${icons.music}<span>Music</span></div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <label class="form-label">Icon / Cover *</label>
                        <div class="icon-upload-wrap">
                            ${uploadIconPreview ? `<div style="position:relative;"><img src="${uploadIconPreview}" class="icon-preview" alt="Icon"><button type="button" onclick="removeUploadIcon()" style="position:absolute;top:-8px;right:-8px;width:24px;height:24px;background:#ef4444;color:white;border:none;border-radius:50%;cursor:pointer;">${icons.x}</button></div>` : `<label class="icon-upload">${icons.image}<span>Add Icon</span><input type="file" accept="image/*" style="display:none;" onchange="handleUploadIconSelect(this)"></label>`}
                            <div class="icon-tips"><p>Square image</p><p>PNG or JPG</p></div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <label class="form-label-sm">Title *</label>
                        <input type="text" class="form-input" placeholder="My Awesome App" value="${uploadFormData.title}" oninput="uploadFormData.title=this.value">
                        <label class="form-label-sm">Short Description</label>
                        <input type="text" class="form-input" placeholder="A brief tagline" value="${uploadFormData.shortDesc}" oninput="uploadFormData.shortDesc=this.value">
                        <label class="form-label-sm">Full Description</label>
                        <textarea class="form-textarea" placeholder="Describe your app..." oninput="uploadFormData.description=this.value">${uploadFormData.description}</textarea>
                        <div class="grid-2" style="margin-top:16px;">
                            <div><label class="form-label-sm">Version</label><input type="text" class="form-input" placeholder="1.0" value="${uploadFormData.version}" oninput="uploadFormData.version=this.value"></div>
                            <div><label class="form-label-sm">Tags</label><input type="text" class="form-input" placeholder="tools" value="${uploadFormData.tags}" oninput="uploadFormData.tags=this.value"></div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <label class="form-label">Download File *</label>
                        <label class="form-label-sm">File Type</label>
                        <select class="form-select" onchange="selectUploadDownloadType(this.value)">
                            ${downloadTypes[uploadCategory].map(t => `<option value="${t.value}" ${uploadDownloadType === t.value ? 'selected' : ''}>${t.label}</option>`).join('')}
                        </select>
                        ${uploadDownloadType === 'pwa' ? `<label class="form-label-sm">PWA URL</label><input type="url" class="form-input" placeholder="https://myapp.com" value="${uploadFormData.pwaUrl}" oninput="uploadFormData.pwaUrl=this.value">` : `
                            ${uploadFileName ? `<div class="file-selected">${icons.file}<div class="file-selected-info"><div class="file-selected-name">${uploadFileName}</div><div class="file-selected-size">${uploadFileSize}</div></div><button type="button" class="file-selected-remove" onclick="removeUploadFile()">${icons.x}</button></div>` : `<label class="file-upload">${icons.upload}<p style="font-weight:500;color:#374151;">Click to upload file</p><p>Any size</p><input type="file" style="display:none;" onchange="handleUploadFileSelect(this)" accept="${uploadCategory === 'app' ? '.apk' : uploadCategory === 'book' ? '.pdf' : 'audio/*'}"></label>`}
                        `}
                    </div>
                    
                    <div class="form-section">
                        <label class="form-label">Screenshots (up to 3)</label>
                        <div class="ss-upload-wrap">
                            ${uploadScreenshots.map((s, i) => `<div class="ss-preview"><img src="${s}" alt="Screenshot"><button type="button" class="ss-remove" onclick="removeUploadScreenshot(${i})">${icons.x}</button></div>`).join('')}
                            ${uploadScreenshots.length < 3 ? `<label class="ss-upload">${icons.plus}<span style="font-size:12px;color:#6b7280;">Add</span><input type="file" accept="image/*" style="display:none;" onchange="handleUploadScreenshotSelect(this)"></label>` : ''}
                        </div>
                    </div>
                    
                    ${isUploading ? `<div class="form-section"><div class="progress-bar"><div class="progress-fill" style="width:${uploadProgress}%"></div></div><p class="upload-status">${uploadStatus}</p></div>` : ''}
                    
                    <button class="download-btn" style="margin-bottom:24px;" onclick="handleUploadSubmit()" ${isUploading ? 'disabled' : ''}>${icons.check} ${isUploading ? 'Uploading...' : 'Publish'}</button>
                </main>
                ${renderBottomNav()}
            `;
        }
        
        // ========== RENDER: PROFILE ==========
        function renderProfile() {
            if (!currentUser) {
                return `<div class="auth-screen"><div class="auth-card">
                    <div class="auth-icon">${icons.user}</div>
                    <h2 class="auth-title">Sign In</h2>
                    <p class="auth-desc">Sign in to view your profile.</p>
                    <button class="btn" style="width:100%;justify-content:center;padding:16px;" onclick="showLoginModal()">Sign In</button>
                    <a href__="#" class="auth-link" onclick="navigateTo('home');return false;">Go back home</a>
                </div></div>${renderBottomNav()}`;
            }
            
            const myApps = dbApps.filter(a => a && a.authorEmail === currentUser.email);
            const totalDownloads = myApps.reduce((sum, a) => sum + (a.downloads || 0), 0);
            
            return `
                <header class="header"><div class="header-content"><div style="display:flex;align-items:center;gap:16px;">
                    <button onclick="navigateTo('home')" style="background:none;border:none;padding:8px;cursor:pointer;">${icons.back}</button>
                    <h1 style="font-weight:600;">My Profile</h1>
                </div></div></header>
                
                <main class="main" style="padding-top:24px;">
                    <div class="profile-card">
                        <div class="profile-header">
                            <div class="profile-avatar">${(currentUser.name || currentUser.email || 'U')[0].toUpperCase()}</div>
                            <div><h2 class="profile-name">${currentUser.name || 'User'}</h2><div class="profile-email">${icons.mail}<span>${currentUser.email}</span></div></div>
                        </div>
                        <div class="profile-stats">
                            <div class="profile-stat"><div class="profile-stat-val">${myApps.length}</div><div class="profile-stat-label">Uploads</div></div>
                            <div class="profile-stat"><div class="profile-stat-val">${formatNumber(totalDownloads)}</div><div class="profile-stat-label">Downloads</div></div>
                        </div>
                        <button class="btn btn-outline" style="width:100%;justify-content:center;" onclick="logout()">${icons.logout} Sign Out</button>
                    </div>
                    
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                        <h3 style="font-size:18px;font-weight:600;">My Uploads</h3>
                        <a href__="#" onclick="navigateTo('upload');return false;" style="color:#059669;font-weight:500;">${icons.plus} Add</a>
                    </div>
                    
                    ${myApps.length > 0 ? myApps.map(app => `
                        <div class="app-card" onclick="viewApp('${app.id}')">
                            <div class="app-icon-wrap">${renderAppIcon(app, 80, 16)}<div class="app-badge">${getCategoryIcon(app.category)}</div></div>
                            <div class="app-info"><div class="app-title">${app.title || 'Untitled'}</div><div class="app-stats"><span>${icons.download} ${formatNumber(app.downloads)}</span></div></div>
                        </div>
                    `).join('') : `<div class="section" style="text-align:center;padding:40px;"><div class="empty-icon" style="margin:0 auto 16px;">${icons.file}</div><h3>No uploads yet</h3><button class="btn" onclick="navigateTo('upload')" style="margin-top:16px;">${icons.plus} Upload Now</button></div>`}
                </main>
                ${renderBottomNav()}
            `;
        }
        
        // ========== EVENT HANDLERS ==========
        function showLoginModal() {
            const modal = document.createElement('div');
            modal.id = 'loginModal'; modal.className = 'modal';
            modal.innerHTML = `<div class="modal-content"><div class="modal-header"><h2>Sign In</h2><button class="modal-close" onclick="closeLoginModal()">${icons.x}</button></div>
                <form onsubmit="handleLogin(event)">
                    <label class="form-label-sm">Full Name</label><input type="text" name="name" class="form-input" placeholder="John Doe" required>
                    <label class="form-label-sm">Email</label><input type="email" name="email" class="form-input" placeholder="john@example.com" required>
                    <button type="submit" class="btn" style="width:100%;justify-content:center;padding:14px;margin-top:8px;">Sign In</button>
                </form>
            </div>`;
            document.body.appendChild(modal);
        }
        
        function closeLoginModal() { const m = document.getElementById('loginModal'); if (m) m.remove(); }
        
        async function handleLogin(e) {
            e.preventDefault();
            currentUser = { name: e.target.name.value, email: e.target.email.value, createdDate: new Date().toISOString() };
            try { await saveUserToDB(currentUser); } catch (err) { console.error(err); }
            closeLoginModal(); render();
        }
        
        function logout() { currentUser = null; navigateTo('home'); }
        
        function selectUploadCategory(cat) {
            uploadCategory = cat;
            uploadDownloadType = cat === 'app' ? 'apk' : cat === 'book' ? 'pdf' : 'audio';
            uploadFileName = null; uploadFileSize = null; uploadFileBase64 = null;
            render();
        }
        
        function selectUploadDownloadType(type) {
            uploadDownloadType = type;
            uploadFileName = null; uploadFileSize = null; uploadFileBase64 = null;
            render();
        }
        
        async function handleUploadIconSelect(input) {
            if (input.files && input.files[0]) {
                const base64 = await fileToBase64(input.files[0]);
                uploadIconBase64 = await compressImage(base64, 200, 0.8);
                uploadIconPreview = uploadIconBase64;
                render();
            }
        }
        
        function removeUploadIcon() { uploadIconPreview = null; uploadIconBase64 = null; render(); }
        
        async function handleUploadFileSelect(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                uploadFileName = file.name;
                uploadFileSize = (file.size / (1024 * 1024)).toFixed(2) + ' MB';
                uploadFileBase64 = await fileToBase64(file);
                render();
            }
        }
        
        function removeUploadFile() { uploadFileName = null; uploadFileSize = null; uploadFileBase64 = null; render(); }
        
        async function handleUploadScreenshotSelect(input) {
            if (input.files && input.files[0]) {
                const base64 = await fileToBase64(input.files[0]);
                uploadScreenshots.push(await compressImage(base64, 400, 0.7));
                render();
            }
        }
        
        function removeUploadScreenshot(i) { uploadScreenshots.splice(i, 1); render(); }
        
        async function handleUploadSubmit() {
            if (!uploadFormData.title.trim()) { alert('Please enter a title'); return; }
            if (!uploadIconBase64) { alert('Please select an icon'); return; }
            if (uploadDownloadType === 'pwa') {
                if (!uploadFormData.pwaUrl.trim()) { alert('Please enter a PWA URL'); return; }
            } else {
                if (!uploadFileBase64) { alert('Please select a file'); return; }
            }
            
            isUploading = true; uploadProgress = 30; uploadStatus = 'Preparing...'; render();
            
            try {
                uploadProgress = 60; uploadStatus = 'Saving...'; render();
                
                await saveAppToDB({
                    title: uploadFormData.title,
                    shortDesc: uploadFormData.shortDesc,
                    description: uploadFormData.description,
                    category: uploadCategory,
                    downloadType: uploadDownloadType,
                    downloadUrl: uploadDownloadType === 'pwa' ? uploadFormData.pwaUrl : '',
                    fileBase64: uploadDownloadType === 'pwa' ? '' : uploadFileBase64,
                    iconUrl: uploadIconBase64,
                    screenshots: uploadScreenshots,
                    version: uploadFormData.version || '1.0',
                    size: uploadFileSize || '',
                    tags: (uploadFormData.tags || '').split(',').map(t => t.trim()).filter(Boolean),
                    author: currentUser.name,
                    authorEmail: currentUser.email,
                    downloads: 0,
                    createdDate: new Date().toISOString()
                });
                
                uploadProgress = 100; uploadStatus = 'Done!'; render();
                await loadAppsFromDB();
                resetUploadData();
                navigateTo('home');
                
            } catch (error) {
                console.error('Upload error:', error);
                alert('Upload failed: ' + error.message);
                isUploading = false; render();
            }
        }
        
        function shareApp() {
            const app = getAllApps().find(a => a.id === selectedAppId);
            if (app && navigator.share) navigator.share({ title: app.title, text: app.shortDesc, url: window.location.href });
        }
        
        // ========== MAIN ==========
        function render() {
            let html = '';
            switch (currentPage) {
                case 'detail': html = renderDetail(); break;
                case 'upload': html = renderUpload(); break;
                case 'profile': html = renderProfile(); break;
                default: html = renderHome();
            }
            document.getElementById('app').innerHTML = html;
        }
        
        render();
        loadAppsFromDB();
    </script>
</body>
</html>
